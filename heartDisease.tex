% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\documentclass[
]{article}
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{amsmath,amssymb}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={Heart Disease Analysis Report},
  pdfauthor={Chan Li Yang Gideon Looi Khoo Phei Ying Ng Jing Lee Ng Wei Khang},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{Heart Disease Analysis Report}
\author{Chan Li Yang Gideon Looi Khoo Phei Ying Ng Jing Lee Ng Wei
Khang}
\date{2025-12-15}

\begin{document}
\maketitle

\subsection{1. Introduction}\label{introduction}

This report analyzes a heart disease health indicators dataset and
builds two predictive tasks:

\begin{itemize}
\tightlist
\item
  \textbf{Classification task:} Predict whether a respondent has had
  heart disease or attack (binary target).
\item
  \textbf{Regression task:} Predict BMI as a continuous target using
  demographic, lifestyle, and health factors.
\end{itemize}

The workflow follows a standard data science pipeline: data loading,
quality checks, preprocessing, feature engineering, exploratory
analysis, correlation screening, train/validation/test split,
normalization, modelling, and evaluation.

\subsection{2. Load Libraries}\label{load-libraries}

This section loads the R libraries required for data manipulation,
visualization, statistical analysis, and machine learning.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(forcats)}

\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(scales)}
\end{Highlighting}
\end{Shaded}

\subsection{3. Load Dataset}\label{load-dataset}

The dataset is imported from a CSV file and inspected to understand its
structure, variable types, and overall distribution.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"C://Users//Wei Khang//heartDisease//heart\_disease.csv"}\NormalTok{)}

\FunctionTok{head}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   HeartDiseaseorAttack HighBP HighChol CholCheck BMI Smoker Stroke Diabetes PhysActivity Fruits Veggies
## 1                    0      1        1         1  40      1      0        0            0      0       1
## 2                    0      0        0         0  25      1      0        0            1      0       0
## 3                    0      1        1         1  28      0      0        0            0      1       0
## 4                    0      1        0         1  27      0      0        0            1      1       1
## 5                    0      1        1         1  24      0      0        0            1      1       1
## 6                    0      1        1         1  25      1      0        0            1      1       1
##   HvyAlcoholConsump AnyHealthcare NoDocbcCost GenHlth MentHlth PhysHlth DiffWalk Sex Age Education Income
## 1                 0             1           0       5       18       15        1   0   9         4      3
## 2                 0             0           1       3        0        0        0   0   7         6      1
## 3                 0             1           1       5       30       30        1   0   9         4      8
## 4                 0             1           0       2        0        0        0   0  11         3      6
## 5                 0             1           0       2        3        0        0   0  11         5      4
## 6                 0             1           0       2        0        2        0   1  10         6      8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 253680     22
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    253680 obs. of  22 variables:
##  $ HeartDiseaseorAttack: num  0 0 0 0 0 0 0 0 1 0 ...
##  $ HighBP              : num  1 0 1 1 1 1 1 1 1 0 ...
##  $ HighChol            : num  1 0 1 0 1 1 0 1 1 0 ...
##  $ CholCheck           : num  1 0 1 1 1 1 1 1 1 1 ...
##  $ BMI                 : num  40 25 28 27 24 25 30 25 30 24 ...
##  $ Smoker              : num  1 1 0 0 0 1 1 1 1 0 ...
##  $ Stroke              : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ Diabetes            : num  0 0 0 0 0 0 0 0 2 0 ...
##  $ PhysActivity        : num  0 1 0 1 1 1 0 1 0 0 ...
##  $ Fruits              : num  0 0 1 1 1 1 0 0 1 0 ...
##  $ Veggies             : num  1 0 0 1 1 1 0 1 1 1 ...
##  $ HvyAlcoholConsump   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ AnyHealthcare       : num  1 0 1 1 1 1 1 1 1 1 ...
##  $ NoDocbcCost         : num  0 1 1 0 0 0 0 0 0 0 ...
##  $ GenHlth             : num  5 3 5 2 2 2 3 3 5 2 ...
##  $ MentHlth            : num  18 0 30 0 3 0 0 0 30 0 ...
##  $ PhysHlth            : num  15 0 30 0 0 2 14 0 30 0 ...
##  $ DiffWalk            : num  1 0 1 0 0 0 0 1 1 0 ...
##  $ Sex                 : num  0 0 0 0 0 1 0 0 0 1 ...
##  $ Age                 : num  9 7 9 11 11 10 9 11 9 8 ...
##  $ Education           : num  4 6 4 3 5 6 6 4 5 4 ...
##  $ Income              : num  3 1 8 6 4 8 7 4 1 3 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(df)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  HeartDiseaseorAttack     HighBP         HighChol        CholCheck           BMI            Smoker      
##  Min.   :0.00000      Min.   :0.000   Min.   :0.0000   Min.   :0.0000   Min.   :12.00   Min.   :0.0000  
##  1st Qu.:0.00000      1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:1.0000   1st Qu.:24.00   1st Qu.:0.0000  
##  Median :0.00000      Median :0.000   Median :0.0000   Median :1.0000   Median :27.00   Median :0.0000  
##  Mean   :0.09419      Mean   :0.429   Mean   :0.4241   Mean   :0.9627   Mean   :28.38   Mean   :0.4431  
##  3rd Qu.:0.00000      3rd Qu.:1.000   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:31.00   3rd Qu.:1.0000  
##  Max.   :1.00000      Max.   :1.000   Max.   :1.0000   Max.   :1.0000   Max.   :98.00   Max.   :1.0000  
##  NA's   :204          NA's   :228     NA's   :213      NA's   :213      NA's   :210     NA's   :235     
##      Stroke           Diabetes       PhysActivity        Fruits          Veggies       HvyAlcoholConsump
##  Min.   :0.00000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   
##  1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:1.0000   1st Qu.:0.0000   1st Qu.:1.0000   1st Qu.:0.0000   
##  Median :0.00000   Median :0.0000   Median :1.0000   Median :1.0000   Median :1.0000   Median :0.0000   
##  Mean   :0.04057   Mean   :0.2969   Mean   :0.7565   Mean   :0.6343   Mean   :0.8114   Mean   :0.0562   
##  3rd Qu.:0.00000   3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:0.0000   
##  Max.   :1.00000   Max.   :2.0000   Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   
##  NA's   :198       NA's   :223      NA's   :216      NA's   :214      NA's   :220      NA's   :220      
##  AnyHealthcare     NoDocbcCost         GenHlth         MentHlth         PhysHlth         DiffWalk     
##  Min.   :0.0000   Min.   :0.00000   Min.   :1.000   Min.   : 0.000   Min.   : 0.000   Min.   :0.0000  
##  1st Qu.:1.0000   1st Qu.:0.00000   1st Qu.:2.000   1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.:0.0000  
##  Median :1.0000   Median :0.00000   Median :2.000   Median : 0.000   Median : 0.000   Median :0.0000  
##  Mean   :0.9511   Mean   :0.08419   Mean   :2.511   Mean   : 3.186   Mean   : 4.242   Mean   :0.1682  
##  3rd Qu.:1.0000   3rd Qu.:0.00000   3rd Qu.:3.000   3rd Qu.: 2.000   3rd Qu.: 3.000   3rd Qu.:0.0000  
##  Max.   :1.0000   Max.   :1.00000   Max.   :5.000   Max.   :30.000   Max.   :30.000   Max.   :1.0000  
##  NA's   :225      NA's   :229       NA's   :213     NA's   :216      NA's   :203      NA's   :231     
##       Sex              Age           Education         Income     
##  Min.   :0.0000   Min.   : 1.000   Min.   :1.000   Min.   :1.000  
##  1st Qu.:0.0000   1st Qu.: 6.000   1st Qu.:4.000   1st Qu.:5.000  
##  Median :0.0000   Median : 8.000   Median :5.000   Median :7.000  
##  Mean   :0.4404   Mean   : 8.032   Mean   :5.051   Mean   :6.054  
##  3rd Qu.:1.0000   3rd Qu.:10.000   3rd Qu.:6.000   3rd Qu.:8.000  
##  Max.   :1.0000   Max.   :13.000   Max.   :6.000   Max.   :8.000  
##  NA's   :230      NA's   :212      NA's   :211     NA's   :228
\end{verbatim}

\subsection{4. Data Quality Checks}\label{data-quality-checks}

This section checks common data issues (missing values and duplicates)
before cleaning. \#\#\# 4.1 Missing Values Missing values are examined
at both the column level and the dataset level to determine the extent
of incomplete records.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{colSums}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## HeartDiseaseorAttack               HighBP             HighChol            CholCheck                  BMI 
##                  204                  228                  213                  213                  210 
##               Smoker               Stroke             Diabetes         PhysActivity               Fruits 
##                  235                  198                  223                  216                  214 
##              Veggies    HvyAlcoholConsump        AnyHealthcare          NoDocbcCost              GenHlth 
##                  220                  220                  225                  229                  213 
##             MentHlth             PhysHlth             DiffWalk                  Sex                  Age 
##                  216                  203                  231                  230                  212 
##            Education               Income 
##                  211                  228
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4792
\end{verbatim}

\subsubsection{4.2 Duplicate Records}\label{duplicate-records}

Duplicate rows are identified, as they may bias descriptive statistics
and model performance.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{duplicated}\NormalTok{(df))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 23697
\end{verbatim}

\subsection{5. Data Preprocessing}\label{data-preprocessing}

Data preprocessing is performed to ensure reliability and consistency of
the dataset. This includes removing missing values, eliminating
duplicate records, handling outliers, and validating variable ranges.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df}
\end{Highlighting}
\end{Shaded}

\subsubsection{5.1 Remove missing values}\label{remove-missing-values}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{drop\_na}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsection{5.2 Remove duplicates}\label{remove-duplicates}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{distinct}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\subsubsection{5.3 Handle BMI outliers
(Winsorization)}\label{handle-bmi-outliers-winsorization}

BMI values are capped at the 1st and 99th percentiles to reduce the
influence of extreme outliers.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bmi\_q }\OtherTok{\textless{}{-}} \FunctionTok{quantile}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{BMI, }\AttributeTok{probs =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\FloatTok{0.99}\NormalTok{), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
\FunctionTok{mutate}\NormalTok{(}\AttributeTok{BMI\_capped =} \FunctionTok{pmin}\NormalTok{(}\FunctionTok{pmax}\NormalTok{(BMI, bmi\_q[}\DecValTok{1}\NormalTok{]), bmi\_q[}\DecValTok{2}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\subsubsection{5.4 Recode General Health
Variable}\label{recode-general-health-variable}

The original \texttt{GenHlth} variable is recorded as an ordinal scale
from 1 to 5.\\
It is recoded into an ordered factor with meaningful labels to improve
interpretability during analysis and visualization.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{GenHlth\_Factor =} \FunctionTok{factor}\NormalTok{(GenHlth,}
                            \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{),}
                            \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Excellent"}\NormalTok{,}\StringTok{"Very Good"}\NormalTok{,}\StringTok{"Good"}\NormalTok{,}\StringTok{"Fair"}\NormalTok{,}\StringTok{"Poor"}\NormalTok{),}
                            \AttributeTok{ordered =} \ConstantTok{TRUE}
\NormalTok{    )}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\subsubsection{5.5 Validate Mental and Physical Health Day
Ranges}\label{validate-mental-and-physical-health-day-ranges}

The \texttt{MentHlth} and \texttt{PhysHlth} variables represent the
number of unhealthy days within the past 30 days. Observations exceeding
this valid range are identified and removed to ensure data integrity.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Count invalid values}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{invalid\_ment }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{MentHlth }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{invalid\_phys }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{PhysHlth }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}

\FunctionTok{cat}\NormalTok{(}\StringTok{"Number of rows with MentHlth \textgreater{} 30:"}\NormalTok{, invalid\_ment, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Number of rows with MentHlth > 30: 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Number of rows with PhysHlth \textgreater{} 30:"}\NormalTok{, invalid\_phys, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Number of rows with PhysHlth > 30: 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Total invalid rows}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{invalid\_total }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{((df\_clean}\SpecialCharTok{$}\NormalTok{MentHlth }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{) }\SpecialCharTok{|}\NormalTok{ (df\_clean}\SpecialCharTok{$}\NormalTok{PhysHlth }\SpecialCharTok{\textgreater{}} \DecValTok{30}\NormalTok{), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{cat}\NormalTok{(}\StringTok{"Total rows to be removed due to invalid health day values:"}\NormalTok{, invalid\_total, }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Total rows to be removed due to invalid health day values: 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Remove invalid rows}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(MentHlth }\SpecialCharTok{\textless{}=} \DecValTok{30}\NormalTok{, PhysHlth }\SpecialCharTok{\textless{}=} \DecValTok{30}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subsection{6. Feature Engineering}\label{feature-engineering}

Feature engineering improves interpretability and may increase
predictive performance by combining multiple related indicators into
higher-level features.

\subsubsection{6.1 BMI Category}\label{bmi-category}

BMI is grouped into standard clinical categories (Underweight, Normal,
Overweight, Obese) to support categorical comparisons in EDA and
modelling.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \CommentTok{\# BMI categorical group}
    \AttributeTok{BMI\_Category =} \FunctionTok{cut}\NormalTok{(}
\NormalTok{      BMI,}
      \AttributeTok{breaks =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\ConstantTok{Inf}\NormalTok{, }\FloatTok{18.5}\NormalTok{, }\DecValTok{25}\NormalTok{, }\DecValTok{30}\NormalTok{, }\ConstantTok{Inf}\NormalTok{),}
      \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Underweight"}\NormalTok{, }\StringTok{"Normal"}\NormalTok{, }\StringTok{"Overweight"}\NormalTok{, }\StringTok{"Obese"}\NormalTok{)}
\NormalTok{    ),}
    \AttributeTok{BMI\_Category =} \FunctionTok{as.factor}\NormalTok{(BMI\_Category)}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(BMI, BMI\_Category) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    BMI BMI_Category
## 1   40        Obese
## 2   25       Normal
## 3   28   Overweight
## 4   27   Overweight
## 5   24       Normal
## 6   25       Normal
## 7   30   Overweight
## 8   25       Normal
## 9   30   Overweight
## 10  24       Normal
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{PhysHlth)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      0      1      2      3      4      5      6      7      8      9     10     11     12     13     14 
## 136221  11002  14410   8395   4494   7553   1312   4513    805    179   5564     59    578     68   2577 
##     15     16     17     18     19     20     21     22     23     24     25     26     27     28     29 
##   4895    111     95    150     22   3250    660     70     55     72   1330     69     97    520    213 
##     30 
##  19286
\end{verbatim}

\subsubsection{6.2 Age Group (CDC Mapping)}\label{age-group-cdc-mapping}

The Age variable is coded from 1--13 and represents age ranges rather
than exact ages. These codes are mapped to meaningful age groups and
treated as ordered categories.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{AgeGroup =} \FunctionTok{factor}\NormalTok{(Age,}
                      \AttributeTok{levels =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{13}\NormalTok{,}
                      \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}
                        \StringTok{"18{-}24"}\NormalTok{, }\StringTok{"25{-}29"}\NormalTok{, }\StringTok{"30{-}34"}\NormalTok{, }\StringTok{"35{-}39"}\NormalTok{, }\StringTok{"40{-}44"}\NormalTok{,}
                        \StringTok{"45{-}49"}\NormalTok{, }\StringTok{"50{-}54"}\NormalTok{, }\StringTok{"55{-}59"}\NormalTok{, }\StringTok{"60{-}64"}\NormalTok{,}
                        \StringTok{"65{-}69"}\NormalTok{, }\StringTok{"70{-}74"}\NormalTok{, }\StringTok{"75{-}79"}\NormalTok{, }\StringTok{"80+"}
\NormalTok{                      ),}
                      \AttributeTok{ordered =} \ConstantTok{TRUE}
\NormalTok{    )}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Age, AgeGroup) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Age AgeGroup
## 1    9    60-64
## 2    7    50-54
## 3    9    60-64
## 4   11    70-74
## 5   11    70-74
## 6   10    65-69
## 7    9    60-64
## 8   11    70-74
## 9    9    60-64
## 10   8    55-59
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{AgeGroup)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## 18-24 25-29 30-34 35-39 40-44 45-49 50-54 55-59 60-64 65-69 70-74 75-79   80+ 
##  5488  7022  9986 12157 13982 17219 23007 27174 29599 29023 21933 15301 16734
\end{verbatim}

\subsubsection{6.3 Broader Age Bands}\label{broader-age-bands}

Broader age bands are created to simplify interpretation and reduce
sparsity when comparing heart disease rates across age.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{AgeBand =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      Age }\SpecialCharTok{\textless{}=} \DecValTok{3}  \SpecialCharTok{\textasciitilde{}} \StringTok{"18{-}34"}\NormalTok{,   }\CommentTok{\# Young adults}
\NormalTok{      Age }\SpecialCharTok{\textless{}=} \DecValTok{6}  \SpecialCharTok{\textasciitilde{}} \StringTok{"35{-}49"}\NormalTok{,   }\CommentTok{\# Middle age}
\NormalTok{      Age }\SpecialCharTok{\textless{}=} \DecValTok{9}  \SpecialCharTok{\textasciitilde{}} \StringTok{"50{-}64"}\NormalTok{,   }\CommentTok{\# Older adults}
\NormalTok{      Age }\SpecialCharTok{\textless{}=} \DecValTok{11} \SpecialCharTok{\textasciitilde{}} \StringTok{"65{-}74"}\NormalTok{,   }\CommentTok{\# Elderly}
      \ConstantTok{TRUE}      \SpecialCharTok{\textasciitilde{}} \StringTok{"75+"}      \CommentTok{\# Very elderly}
\NormalTok{    ),}
    \AttributeTok{AgeBand =} \FunctionTok{factor}\NormalTok{(AgeBand, }\AttributeTok{ordered =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(Age, AgeBand) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Age AgeBand
## 1    9   50-64
## 2    7   50-64
## 3    9   50-64
## 4   11   65-74
## 5   11   65-74
## 6   10   65-74
## 7    9   50-64
## 8   11   65-74
## 9    9   50-64
## 10   8   50-64
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{AgeBand)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## 18-34 35-49 50-64 65-74   75+ 
## 22496 43358 79780 50956 32035
\end{verbatim}

\subsubsection{6.4 Lifestyle Risk Score}\label{lifestyle-risk-score}

A composite Lifestyle Risk Score is constructed by combining multiple
unhealthy lifestyle behaviours into a single index. Higher scores
represent higher lifestyle risk.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{RiskScore =}
      \FunctionTok{as.numeric}\NormalTok{(Smoker) }\SpecialCharTok{+}              \CommentTok{\# Smoking behavior}
      \FunctionTok{as.numeric}\NormalTok{(HvyAlcoholConsump) }\SpecialCharTok{+}   \CommentTok{\# Heavy drinking behavior}
\NormalTok{      (}\DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{as.numeric}\NormalTok{(PhysActivity)) }\SpecialCharTok{+}  \CommentTok{\# Inactivity}
\NormalTok{      (}\DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{as.numeric}\NormalTok{(Fruits)) }\SpecialCharTok{+}        \CommentTok{\# Low fruit intake}
\NormalTok{      (}\DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{as.numeric}\NormalTok{(Veggies))         }\CommentTok{\# Low vegetable intake}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(Smoker, HvyAlcoholConsump, PhysActivity, Fruits, Veggies, RiskScore) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Smoker HvyAlcoholConsump PhysActivity Fruits Veggies RiskScore
## 1       1                 0            0      0       1         3
## 2       1                 0            1      0       0         3
## 3       0                 0            0      1       0         2
## 4       0                 0            1      1       1         0
## 5       0                 0            1      1       1         0
## 6       1                 0            1      1       1         1
## 7       1                 0            0      0       0         4
## 8       1                 0            1      0       1         2
## 9       1                 0            0      1       1         2
## 10      0                 0            0      0       1         2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{RiskScore)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   1.000   1.000   1.385   2.000   5.000
\end{verbatim}

\subsubsection{6.5 Disease Burden Index}\label{disease-burden-index}

Disease burden is measured as the count of chronic conditions (high
blood pressure, high cholesterol, diabetes, and stroke history).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{DiseaseCount =}
      \FunctionTok{as.numeric}\NormalTok{(HighBP) }\SpecialCharTok{+}      \CommentTok{\# High blood pressure}
      \FunctionTok{as.numeric}\NormalTok{(HighChol) }\SpecialCharTok{+}    \CommentTok{\# High cholesterol}
      \FunctionTok{as.numeric}\NormalTok{(Diabetes) }\SpecialCharTok{+}    \CommentTok{\# Diabetes}
      \FunctionTok{as.numeric}\NormalTok{(Stroke)        }\CommentTok{\# History of stroke}
\NormalTok{  )}

\CommentTok{\# Inspect disease burden result}
\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(HighBP, HighChol, Diabetes, Stroke, DiseaseCount) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    HighBP HighChol Diabetes Stroke DiseaseCount
## 1       1        1        0      0            2
## 2       0        0        0      0            0
## 3       1        1        0      0            2
## 4       1        0        0      0            1
## 5       1        1        0      0            2
## 6       1        1        0      0            2
## 7       1        0        0      0            1
## 8       1        1        0      0            2
## 9       1        1        2      0            4
## 10      0        0        0      0            0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{DiseaseCount)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##     0     1     2     3     4     5 
## 79409 67121 46035 16094 17780  2186
\end{verbatim}

\subsubsection{6.6 Health Stress Index (Mental + Physical
Health)}\label{health-stress-index-mental-physical-health}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{HealthStressIndex =}\NormalTok{ MentHlth }\SpecialCharTok{+}\NormalTok{ PhysHlth}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(MentHlth, PhysHlth, HealthStressIndex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    MentHlth PhysHlth HealthStressIndex
## 1        18       15                33
## 2         0        0                 0
## 3        30       30                60
## 4         0        0                 0
## 5         3        0                 3
## 6         0        2                 2
## 7         0       14                14
## 8         0        0                 0
## 9        30       30                60
## 10        0        0                 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{summary}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{HealthStressIndex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00    0.00    2.00    8.18   10.00   60.00
\end{verbatim}

\subsubsection{6.7 Healthcare Access
Score}\label{healthcare-access-score}

Healthcare access is summarized using insurance coverage and
affordability of doctor visits.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{HealthcareScore =}
      \FunctionTok{as.numeric}\NormalTok{(AnyHealthcare) }\SpecialCharTok{+}       \CommentTok{\# Has insurance}
\NormalTok{      (}\DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{as.numeric}\NormalTok{(NoDocbcCost))     }\CommentTok{\# Could afford doctor visit}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(AnyHealthcare, NoDocbcCost, HealthcareScore) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    AnyHealthcare NoDocbcCost HealthcareScore
## 1              1           0               2
## 2              0           1               0
## 3              1           1               1
## 4              1           0               2
## 5              1           0               2
## 6              1           0               2
## 7              1           0               2
## 8              1           0               2
## 9              1           0               2
## 10             1           0               2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{HealthcareScore)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      0      1      2 
##   4556  24432 199637
\end{verbatim}

\subsubsection{6.8 Obesity Flag}\label{obesity-flag}

An obesity indicator is created using the BMI â‰¥ 30 threshold.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{ObeseFlag =} \FunctionTok{ifelse}\NormalTok{(BMI }\SpecialCharTok{\textgreater{}=} \DecValTok{30}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{),}
    \AttributeTok{ObeseFlag =} \FunctionTok{factor}\NormalTok{(ObeseFlag)}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(BMI, ObeseFlag) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    BMI ObeseFlag
## 1   40         1
## 2   25         0
## 3   28         0
## 4   27         0
## 5   24         0
## 6   25         0
## 7   30         1
## 8   25         0
## 9   30         1
## 10  24         0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{ObeseFlag)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      0      1 
## 144111  84514
\end{verbatim}

\subsubsection{6.9 Lifestyle Profile
Category}\label{lifestyle-profile-category}

RiskScore is converted into an interpretable categorical lifestyle
profile (Healthy, ModerateRisk, HighRisk).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_clean }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{LifestyleProfile =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      RiskScore }\SpecialCharTok{\textless{}=} \DecValTok{1} \SpecialCharTok{\textasciitilde{}} \StringTok{"Healthy"}\NormalTok{,}
\NormalTok{      RiskScore }\SpecialCharTok{\textless{}=} \DecValTok{3} \SpecialCharTok{\textasciitilde{}} \StringTok{"ModerateRisk"}\NormalTok{,}
      \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \StringTok{"HighRisk"}
\NormalTok{    ),}
    \AttributeTok{LifestyleProfile =} \FunctionTok{factor}\NormalTok{(LifestyleProfile)}
\NormalTok{  )}

\NormalTok{df\_clean }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(RiskScore, LifestyleProfile) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    RiskScore LifestyleProfile
## 1          3     ModerateRisk
## 2          3     ModerateRisk
## 3          2     ModerateRisk
## 4          0          Healthy
## 5          0          Healthy
## 6          1          Healthy
## 7          4         HighRisk
## 8          2     ModerateRisk
## 9          2     ModerateRisk
## 10         2     ModerateRisk
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(df\_clean}\SpecialCharTok{$}\NormalTok{LifestyleProfile)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
##      Healthy     HighRisk ModerateRisk 
##       133274         8424        86927
\end{verbatim}

\subsection{7. Exploratory Data
Analysis}\label{exploratory-data-analysis}

Exploratory analysis is conducted to examine the distribution of the
target variable and its association with key engineered features (age,
sex, BMI category, obesity status, lifestyle profile, and self-reported
health).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(scales)}

\NormalTok{df\_plot }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{HeartDisease =} \FunctionTok{factor}\NormalTok{(HeartDiseaseorAttack,}
                          \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{),}
                          \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"No"}\NormalTok{, }\StringTok{"Yes"}\NormalTok{)),}
    \AttributeTok{SexLabel =} \FunctionTok{factor}\NormalTok{(Sex,}
                      \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{),}
                      \AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Female"}\NormalTok{, }\StringTok{"Male"}\NormalTok{))}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\subsubsection{7.1 Heart Disease
Prevalence}\label{heart-disease-prevalence}

This plot summarizes the overall prevalence of heart disease/attack in
the dataset.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_donut }\OtherTok{\textless{}{-}}\NormalTok{ df\_plot }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{count}\NormalTok{(HeartDisease) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{prop =}\NormalTok{ n }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(n))}

\FunctionTok{ggplot}\NormalTok{(df\_donut, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =} \DecValTok{2}\NormalTok{, }\AttributeTok{y =}\NormalTok{ prop, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\AttributeTok{width =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{coord\_polar}\NormalTok{(}\AttributeTok{theta =} \StringTok{"y"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlim}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{2.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_void}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Prevalence (Donut Chart)"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_text}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =} \FunctionTok{percent}\NormalTok{(prop)), }
            \AttributeTok{position =} \FunctionTok{position\_stack}\NormalTok{(}\AttributeTok{vjust =} \FloatTok{0.5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-21-1.pdf}}
\#\#\#\# Observation: The donut chart shows that approximately
\textbf{10\%} of individuals in the dataset have experienced heart
disease or attack, while \textbf{90\%} have not.

\paragraph{Conclusion:}\label{conclusion}

Heart disease cases form a \textbf{minority class}, indicating a
\textbf{class-imbalanced dataset}, which should be considered during
model training and evaluation.

\subsubsection{7.2 Heart Disease Rate by Age
Band}\label{heart-disease-rate-by-age-band}

Heart disease proportion is compared across age bands to assess how
prevalence changes with age.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ AgeBand, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ percent) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Rate by Age Band"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Age Band"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Proportion"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-22-1.pdf}}
\#\#\#\# Observation: The proportion of heart disease \textbf{increases
steadily with age}, with the lowest prevalence in the 18--34 group and
the highest in the \textbf{75+} group.

\paragraph{Conclusion:}\label{conclusion-1}

Age is a \textbf{strong risk factor} for heart disease, and older age
bands are significantly more vulnerable, highlighting the importance of
age in predictive modelling.

\subsubsection{7.3 Heart Disease Rate by
Sex}\label{heart-disease-rate-by-sex}

This plot compares heart disease prevalence between male and female
respondents.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ SexLabel, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}                       \CommentTok{\# ok}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#F76C6C"}\NormalTok{, }\StringTok{"\#1ECBE1"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ percent) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Rate by Sex"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Sex"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Proportion"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{14}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-23-1.pdf}}
\#\#\#\# Observation: Males exhibit a \textbf{higher proportion} of
heart disease cases compared to females.

\paragraph{Conclusion:}\label{conclusion-2}

Sex appears to be an \textbf{important demographic factor}, with males
showing greater susceptibility to heart disease in this dataset.

\subsubsection{7.4 Heart Disease Rate by BMI
Category}\label{heart-disease-rate-by-bmi-category}

Heart disease prevalence is compared across BMI categories.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(BMI\_Category, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#F9A825"}\NormalTok{, }\StringTok{"\#1976D2"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Rate by BMI Category"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"BMI Category"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Proportion"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ percent) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{14}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-24-1.pdf}}
\#\#\#\# Observation: Heart disease prevalence is \textbf{lowest in the
Normal BMI group} and higher among \textbf{Overweight and Obese}
individuals, with Obese showing the highest proportion.

\paragraph{Conclusion:}\label{conclusion-3}

Higher BMI is associated with an \textbf{increased risk of heart
disease}, indicating BMI as an important predictive health indicator.

\subsubsection{7.5 Heart Disease Rate by Obesity
Status}\label{heart-disease-rate-by-obesity-status}

This plot compares heart disease prevalence between obese and non-obese
individuals.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(}\FunctionTok{factor}\NormalTok{(ObeseFlag), }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}                  \CommentTok{\# ok}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{, }\AttributeTok{width =} \FloatTok{0.5}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#81D4FA"}\NormalTok{, }\StringTok{"\#EF5350"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Rate by Obesity Status"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Obesity (0 = No, 1 = Yes)"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Proportion"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ percent) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{14}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-25-1.pdf}}
\#\#\#\# Observation: Obese individuals (Obesity = 1) exhibit a
\textbf{higher proportion of heart disease} compared to non-obese
individuals.

\paragraph{Conclusion:}\label{conclusion-4}

Obesity status is \textbf{positively associated} with heart disease
prevalence, reinforcing its role as a key risk factor.

\subsubsection{7.6 Heart Disease Rate by Lifestyle
Profile}\label{heart-disease-rate-by-lifestyle-profile}

This plot evaluates heart disease prevalence across lifestyle risk
profiles.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(LifestyleProfile, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{, }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#43A047"}\NormalTok{, }\StringTok{"\#EF5350"}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ percent) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Rate by Lifestyle Profile"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Lifestyle Category"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Proportion"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{(}\AttributeTok{base\_size =} \DecValTok{14}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-26-1.pdf}}
\#\#\#\# Observation: The *High-Risk lifestyle group** shows the highest
heart disease prevalence, followed by the Moderate-Risk group, while the
Healthy group has the lowest.

\paragraph{Conclusion:}\label{conclusion-5}

Unhealthy lifestyle behaviours significantly \textbf{increase heart
disease risk}, highlighting the impact of combined lifestyle factors.

\subsubsection{7.7 Heart Disease Rate by Self-Reported General
Health}\label{heart-disease-rate-by-self-reported-general-health}

Self-reported general health is compared against heart disease
prevalence.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ GenHlth\_Factor, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{(}\AttributeTok{position =} \StringTok{"fill"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{labels =}\NormalTok{ percent) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Heart Disease Rate by Self{-}Reported General Health"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"General Health"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"Proportion"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{axis.text.x =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{angle =} \DecValTok{45}\NormalTok{, }\AttributeTok{hjust =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-27-1.pdf}}
\#\#\#\# Observation: Heart disease prevalence \textbf{increases
sharply} as self-reported general health declines from Excellent to
Poor.

\paragraph{Conclusion:}\label{conclusion-6}

Self-reported general health is a \textbf{strong indicator} of heart
disease risk and reflects overall physical well-being.

\subsubsection{7.8 Health Stress Index by Heart Disease
Status}\label{health-stress-index-by-heart-disease-status}

This boxplot compares the distribution of combined physical and mental
unhealthy days between individuals with and without heart disease.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(df\_plot, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ HeartDisease, }\AttributeTok{y =}\NormalTok{ HealthStressIndex, }\AttributeTok{fill =}\NormalTok{ HeartDisease)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Health Stress Index by Heart Disease Status"}\NormalTok{,}
       \AttributeTok{x =} \StringTok{"Heart Disease or Attack"}\NormalTok{,}
       \AttributeTok{y =} \StringTok{"HealthStressIndex"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-28-1.pdf}}
Observation: Individuals with heart disease have a \textbf{higher median
Health Stress Index} and greater variability compared to those without
heart disease.

Conclusion: Poor physical and mental health (higher stress burden) is
\textbf{strongly associated} with heart disease presence.

\subsection{8. Correlation Analysis}\label{correlation-analysis}

Correlation analysis is conducted to examine linear relationships among
features and to support feature selection for both classification and
regression tasks. Since correlation requires numeric inputs, categorical
variables are converted into numeric codes. This analysis is exploratory
and does not imply causation.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(corrplot)}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\subsubsection{8.1 Preparation of Numeric Feature
Matrix}\label{preparation-of-numeric-feature-matrix}

All factor variables are converted to numeric codes, and the binary
target variable is encoded as 0/1 for correlation computation.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_corr }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{HeartDisease\_num =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(HeartDiseaseorAttack))}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{HeartDiseaseorAttack) }\SpecialCharTok{\%\textgreater{}\%}       
  \FunctionTok{mutate}\NormalTok{(}
    \FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.factor), }\SpecialCharTok{\textasciitilde{}} \FunctionTok{as.numeric}\NormalTok{(.))   }
\NormalTok{  )}

\FunctionTok{cat}\NormalTok{(}\StringTok{"Number of features used for correlation:"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(df\_corr), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Number of features used for correlation: 33
\end{verbatim}

\subsubsection{8.2 Correlation Matrix
Computation}\label{correlation-matrix-computation}

The correlation matrix is computed using pairwise complete observations
to handle any remaining missing values safely.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cor\_mat }\OtherTok{\textless{}{-}} \FunctionTok{cor}\NormalTok{(df\_corr, }\AttributeTok{use =} \StringTok{"pairwise.complete.obs"}\NormalTok{)}

\FunctionTok{dim}\NormalTok{(cor\_mat)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 33 33
\end{verbatim}

\subsubsection{8.3 Correlation Heatmap}\label{correlation-heatmap}

The heatmap below visualizes the upper triangle of the correlation
matrix to reduce redundancy and improve readability.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{corrplot}\NormalTok{(cor\_mat,}
         \AttributeTok{method =} \StringTok{"color"}\NormalTok{,}
         \AttributeTok{type   =} \StringTok{"upper"}\NormalTok{,}
         \AttributeTok{tl.col =} \StringTok{"black"}\NormalTok{,}
         \AttributeTok{tl.srt =} \DecValTok{45}\NormalTok{,}
         \AttributeTok{number.cex =} \FloatTok{0.5}\NormalTok{,}
         \AttributeTok{main  =} \StringTok{"Correlation Heatmap of All Features"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{heartDisease_files/figure-latex/unnamed-chunk-32-1.pdf}}

\subsubsection{8.4 Feature Correlation with BMI (Regression
Target)}\label{feature-correlation-with-bmi-regression-target}

This section examines correlations between BMI and other features to
support regression feature selection.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\StringTok{"BMI"} \SpecialCharTok{\%in\%} \FunctionTok{rownames}\NormalTok{(cor\_mat)) \{}
\NormalTok{  bmi\_cor }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(cor\_mat[}\StringTok{"BMI"}\NormalTok{, ], }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Correlation with BMI:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{round}\NormalTok{(bmi\_cor, }\DecValTok{3}\NormalTok{))}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \FunctionTok{warning}\NormalTok{(}\StringTok{"BMI not found in correlation matrix row names."}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Correlation with BMI:
##               BMI        BMI_capped      BMI_Category         ObeseFlag      DiseaseCount          Diabetes 
##             1.000             0.971             0.808             0.740             0.234             0.212 
##           GenHlth    GenHlth_Factor            HighBP          DiffWalk HealthStressIndex          PhysHlth 
##             0.208             0.208             0.194             0.183             0.106             0.103 
##          HighChol         RiskScore  LifestyleProfile          MentHlth       NoDocbcCost         CholCheck 
##             0.090             0.082             0.074             0.069             0.046             0.042 
##  HeartDisease_num               Sex            Stroke     AnyHealthcare            Smoker   HealthcareScore 
##             0.040             0.031             0.011            -0.009            -0.009            -0.038 
##           Veggies               Age          AgeGroup HvyAlcoholConsump           AgeBand            Fruits 
##            -0.044            -0.050            -0.050            -0.058            -0.060            -0.068 
##            Income         Education      PhysActivity 
##            -0.069            -0.075            -0.128
\end{verbatim}

\subsubsection{8.5 Feature Correlation with Heart Disease
(Classification
Target)}\label{feature-correlation-with-heart-disease-classification-target}

This section examines correlations between the binary heart disease
outcome and other features.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{ (}\StringTok{"HeartDisease\_num"} \SpecialCharTok{\%in\%} \FunctionTok{rownames}\NormalTok{(cor\_mat)) \{}
\NormalTok{  hd\_cor }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(cor\_mat[}\StringTok{"HeartDisease\_num"}\NormalTok{, ], }\AttributeTok{decreasing =} \ConstantTok{TRUE}\NormalTok{)}
  \FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Correlation with HeartDiseaseorAttack (0/1):}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
  \FunctionTok{print}\NormalTok{(}\FunctionTok{round}\NormalTok{(hd\_cor, }\DecValTok{3}\NormalTok{))}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \FunctionTok{warning}\NormalTok{(}\StringTok{"HeartDisease\_num not found in correlation matrix row names."}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Correlation with HeartDiseaseorAttack (0/1):
##  HeartDisease_num      DiseaseCount           GenHlth    GenHlth_Factor               Age          AgeGroup 
##             1.000             0.278             0.246             0.246             0.223             0.223 
##           AgeBand          DiffWalk            HighBP            Stroke          HighChol          Diabetes 
##             0.221             0.203             0.201             0.199             0.176             0.171 
##          PhysHlth HealthStressIndex            Smoker               Sex         RiskScore  LifestyleProfile 
##             0.171             0.142             0.105             0.090             0.083             0.064 
##          MentHlth         CholCheck      BMI_Category        BMI_capped               BMI         ObeseFlag 
##             0.053             0.050             0.045             0.045             0.040             0.039 
##     AnyHealthcare       NoDocbcCost   HealthcareScore            Fruits           Veggies HvyAlcoholConsump 
##             0.026             0.022            -0.001            -0.007            -0.027            -0.035 
##      PhysActivity         Education            Income 
##            -0.073            -0.083            -0.123
\end{verbatim}

\subsection{9. Dataset Construction and
Partitioning}\label{dataset-construction-and-partitioning}

This section prepares two modelling datasets: (1) a classification
dataset for predicting heart disease occurrence and (2) a regression
dataset for predicting BMI. Features are selected based on exploratory
correlation screening and domain knowledge.

\subsubsection{9.1 Feature Selection for Classification and
Regression}\label{feature-selection-for-classification-and-regression}

For classification, a set of demographic, health condition, and
engineered lifestyle features is selected. For regression, BMI is
treated as the target variable and additional socioeconomic factors
(income and education) are included.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Classification features}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# }\AlertTok{NOTE}\CommentTok{: MentHlth and PhysHlth are included once only (avoid duplicates).}
\NormalTok{clf\_features }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"HeartDiseaseorAttack"}\NormalTok{,  }\CommentTok{\# target}
  \StringTok{"Age"}\NormalTok{, }\StringTok{"AgeGroup"}\NormalTok{, }\StringTok{"AgeBand"}\NormalTok{,}
  \StringTok{"Sex"}\NormalTok{,}
  \StringTok{"HighBP"}\NormalTok{, }\StringTok{"HighChol"}\NormalTok{, }\StringTok{"Diabetes"}\NormalTok{, }\StringTok{"Stroke"}\NormalTok{,}
  \StringTok{"Smoker"}\NormalTok{, }\StringTok{"PhysActivity"}\NormalTok{,}
  \StringTok{"MentHlth"}\NormalTok{, }\StringTok{"PhysHlth"}\NormalTok{, }\StringTok{"HealthStressIndex"}\NormalTok{,}
  \StringTok{"DiseaseCount"}\NormalTok{, }\StringTok{"ObeseFlag"}\NormalTok{,}
  \StringTok{"RiskScore"}\NormalTok{, }\StringTok{"LifestyleProfile"}\NormalTok{,}
  \StringTok{"BMI"}
\NormalTok{)}

\NormalTok{df\_clf\_raw }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(clf\_features))}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Regression features}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{reg\_features }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"BMI"}\NormalTok{,                   }\CommentTok{\# target}
  \StringTok{"Age"}\NormalTok{, }\StringTok{"AgeGroup"}\NormalTok{, }\StringTok{"AgeBand"}\NormalTok{,}
  \StringTok{"Sex"}\NormalTok{,}
  \StringTok{"HighBP"}\NormalTok{, }\StringTok{"HighChol"}\NormalTok{, }\StringTok{"Diabetes"}\NormalTok{, }\StringTok{"Stroke"}\NormalTok{,}
  \StringTok{"Smoker"}\NormalTok{, }\StringTok{"PhysActivity"}\NormalTok{,}
  \StringTok{"MentHlth"}\NormalTok{, }\StringTok{"PhysHlth"}\NormalTok{, }\StringTok{"HealthStressIndex"}\NormalTok{,}
  \StringTok{"DiseaseCount"}\NormalTok{, }\StringTok{"RiskScore"}\NormalTok{, }\StringTok{"LifestyleProfile"}\NormalTok{,}
  \StringTok{"Income"}\NormalTok{, }\StringTok{"Education"}
\NormalTok{)}

\NormalTok{df\_reg\_raw }\OtherTok{\textless{}{-}}\NormalTok{ df\_clean }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{all\_of}\NormalTok{(reg\_features))}
\end{Highlighting}
\end{Shaded}

\subsubsection{9.2 Train/Validation/Test
Split}\label{trainvalidationtest-split}

A 60/20/20 split is applied to support model tuning (validation set) and
unbiased evaluation (test set). A fixed random seed is used for
reproducibility.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}

\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(df\_clean)}
\NormalTok{indices }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq\_len}\NormalTok{(n))}

\NormalTok{train\_size }\OtherTok{\textless{}{-}} \FunctionTok{floor}\NormalTok{(}\FloatTok{0.6} \SpecialCharTok{*}\NormalTok{ n)}
\NormalTok{valid\_size }\OtherTok{\textless{}{-}} \FunctionTok{floor}\NormalTok{(}\FloatTok{0.2} \SpecialCharTok{*}\NormalTok{ n)}

\NormalTok{train\_idx }\OtherTok{\textless{}{-}}\NormalTok{ indices[}\DecValTok{1}\SpecialCharTok{:}\NormalTok{train\_size]}
\NormalTok{valid\_idx }\OtherTok{\textless{}{-}}\NormalTok{ indices[(train\_size }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\NormalTok{(train\_size }\SpecialCharTok{+}\NormalTok{ valid\_size)]}
\NormalTok{test\_idx  }\OtherTok{\textless{}{-}}\NormalTok{ indices[(train\_size }\SpecialCharTok{+}\NormalTok{ valid\_size }\SpecialCharTok{+} \DecValTok{1}\NormalTok{)}\SpecialCharTok{:}\NormalTok{n]}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Train:"}\NormalTok{, }\FunctionTok{length}\NormalTok{(train\_idx),}
    \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Valid:"}\NormalTok{, }\FunctionTok{length}\NormalTok{(valid\_idx),}
    \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Test:"}\NormalTok{,  }\FunctionTok{length}\NormalTok{(test\_idx), }\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Train: 137175 
## Valid: 45725 
## Test: 45725
\end{verbatim}

\subsubsection{9.3 Build Classification and Regression
Datasets}\label{build-classification-and-regression-datasets}

The classification target is converted into a factor (``No''/``Yes'')
for modelling workflows such as SMOTE, while regression retains BMI as a
numeric outcome.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Classification split}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{train\_clf }\OtherTok{\textless{}{-}}\NormalTok{ df\_clf\_raw[train\_idx, ]}
\NormalTok{valid\_clf }\OtherTok{\textless{}{-}}\NormalTok{ df\_clf\_raw[valid\_idx, ]}
\NormalTok{test\_clf  }\OtherTok{\textless{}{-}}\NormalTok{ df\_clf\_raw[test\_idx, ]}

\NormalTok{train\_clf}\SpecialCharTok{$}\NormalTok{HeartDisease }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(train\_clf}\SpecialCharTok{$}\NormalTok{HeartDiseaseorAttack, }\AttributeTok{levels=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"No"}\NormalTok{,}\StringTok{"Yes"}\NormalTok{))}
\NormalTok{valid\_clf}\SpecialCharTok{$}\NormalTok{HeartDisease }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(valid\_clf}\SpecialCharTok{$}\NormalTok{HeartDiseaseorAttack, }\AttributeTok{levels=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"No"}\NormalTok{,}\StringTok{"Yes"}\NormalTok{))}
\NormalTok{test\_clf}\SpecialCharTok{$}\NormalTok{HeartDisease  }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(test\_clf}\SpecialCharTok{$}\NormalTok{HeartDiseaseorAttack, }\AttributeTok{levels=}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }\AttributeTok{labels=}\FunctionTok{c}\NormalTok{(}\StringTok{"No"}\NormalTok{,}\StringTok{"Yes"}\NormalTok{))}

\NormalTok{train\_clf }\OtherTok{\textless{}{-}}\NormalTok{ train\_clf }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{HeartDiseaseorAttack) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{relocate}\NormalTok{(HeartDisease)}
\NormalTok{valid\_clf }\OtherTok{\textless{}{-}}\NormalTok{ valid\_clf }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{HeartDiseaseorAttack) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{relocate}\NormalTok{(HeartDisease)}
\NormalTok{test\_clf  }\OtherTok{\textless{}{-}}\NormalTok{ test\_clf  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{HeartDiseaseorAttack) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{relocate}\NormalTok{(HeartDisease)}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Regression split}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{train\_reg }\OtherTok{\textless{}{-}}\NormalTok{ df\_reg\_raw[train\_idx, ]}
\NormalTok{valid\_reg }\OtherTok{\textless{}{-}}\NormalTok{ df\_reg\_raw[valid\_idx, ]}
\NormalTok{test\_reg  }\OtherTok{\textless{}{-}}\NormalTok{ df\_reg\_raw[test\_idx, ]}
\end{Highlighting}
\end{Shaded}

\subsection{10. Normalization (Train-only
Fitting)}\label{normalization-train-only-fitting}

Selected numeric variables are standardised using mean and standard
deviation estimated from the training set only. The learned scaling
parameters are then applied to validation and test sets to prevent data
leakage.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Variables to Scale}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{scale\_cols }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"BMI"}\NormalTok{, }\StringTok{"MentHlth"}\NormalTok{, }\StringTok{"PhysHlth"}\NormalTok{)}

\CommentTok{\# Fit scaler on TRAIN ONLY (classification train still contains these columns before dropping)}
\NormalTok{scaler\_means }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(train\_clf[, scale\_cols], mean)}
\NormalTok{scaler\_sds   }\OtherTok{\textless{}{-}} \FunctionTok{sapply}\NormalTok{(train\_clf[, scale\_cols], sd)}

\NormalTok{scale\_apply }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, cols, means, sds) \{}
\NormalTok{  df[, }\FunctionTok{paste0}\NormalTok{(cols, }\StringTok{"\_scaled"}\NormalTok{)] }\OtherTok{\textless{}{-}} \FunctionTok{sweep}\NormalTok{(df[, cols], }\DecValTok{2}\NormalTok{, means, }\AttributeTok{FUN =} \StringTok{"{-}"}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ sds}
  \FunctionTok{return}\NormalTok{(df)}
\NormalTok{\}}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Apply Scaling}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{train\_clf }\OtherTok{\textless{}{-}} \FunctionTok{scale\_apply}\NormalTok{(train\_clf, scale\_cols, scaler\_means, scaler\_sds)}
\NormalTok{valid\_clf }\OtherTok{\textless{}{-}} \FunctionTok{scale\_apply}\NormalTok{(valid\_clf, scale\_cols, scaler\_means, scaler\_sds)}
\NormalTok{test\_clf  }\OtherTok{\textless{}{-}} \FunctionTok{scale\_apply}\NormalTok{(test\_clf,  scale\_cols, scaler\_means, scaler\_sds)}

\NormalTok{train\_reg }\OtherTok{\textless{}{-}} \FunctionTok{scale\_apply}\NormalTok{(train\_reg, scale\_cols, scaler\_means, scaler\_sds)}
\NormalTok{valid\_reg }\OtherTok{\textless{}{-}} \FunctionTok{scale\_apply}\NormalTok{(valid\_reg, scale\_cols, scaler\_means, scaler\_sds)}
\NormalTok{test\_reg  }\OtherTok{\textless{}{-}} \FunctionTok{scale\_apply}\NormalTok{(test\_reg,  scale\_cols, scaler\_means, scaler\_sds)}
\end{Highlighting}
\end{Shaded}

\subsubsection{10.1 Drop Unscaled Versions Where
Appropriate}\label{drop-unscaled-versions-where-appropriate}

For classification, unscaled BMI/MentHlth/PhysHlth are removed after
scaling. For regression, BMI is retained as the target; the scaled BMI
column is removed.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Classification: drop unscaled originals}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{train\_clf }\OtherTok{\textless{}{-}}\NormalTok{ train\_clf }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{BMI, }\SpecialCharTok{{-}}\NormalTok{MentHlth, }\SpecialCharTok{{-}}\NormalTok{PhysHlth)}
\NormalTok{valid\_clf }\OtherTok{\textless{}{-}}\NormalTok{ valid\_clf }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{BMI, }\SpecialCharTok{{-}}\NormalTok{MentHlth, }\SpecialCharTok{{-}}\NormalTok{PhysHlth)}
\NormalTok{test\_clf  }\OtherTok{\textless{}{-}}\NormalTok{ test\_clf  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{BMI, }\SpecialCharTok{{-}}\NormalTok{MentHlth, }\SpecialCharTok{{-}}\NormalTok{PhysHlth)}

\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# Regression: keep BMI target, drop BMI\_scaled and unscaled Ment/Phys}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{train\_reg }\OtherTok{\textless{}{-}}\NormalTok{ train\_reg }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{BMI\_scaled,}\SpecialCharTok{{-}}\NormalTok{MentHlth, }\SpecialCharTok{{-}}\NormalTok{PhysHlth)}
\NormalTok{valid\_reg }\OtherTok{\textless{}{-}}\NormalTok{ valid\_reg }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{BMI\_scaled,}\SpecialCharTok{{-}}\NormalTok{MentHlth, }\SpecialCharTok{{-}}\NormalTok{PhysHlth)}
\NormalTok{test\_reg  }\OtherTok{\textless{}{-}}\NormalTok{ test\_reg  }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{BMI\_scaled,}\SpecialCharTok{{-}}\NormalTok{MentHlth, }\SpecialCharTok{{-}}\NormalTok{PhysHlth)}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{==== FINAL DATASET SHAPES ==== }\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## ==== FINAL DATASET SHAPES ====
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{[Classification]}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## [Classification]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Train:"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(train\_clf), }\StringTok{"rows,"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(train\_clf), }\StringTok{"columns}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Train: 137175 rows, 19 columns
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Valid:"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(valid\_clf), }\StringTok{"rows,"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(valid\_clf), }\StringTok{"columns}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Valid: 45725 rows, 19 columns
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Test :"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(test\_clf),  }\StringTok{"rows,"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(test\_clf),  }\StringTok{"columns}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Test : 45725 rows, 19 columns
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{[Regression]}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## [Regression]
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Train:"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(train\_reg), }\StringTok{"rows,"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(train\_reg), }\StringTok{"columns}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Train: 137175 rows, 19 columns
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Valid:"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(valid\_reg), }\StringTok{"rows,"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(valid\_reg), }\StringTok{"columns}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Valid: 45725 rows, 19 columns
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"Test :"}\NormalTok{, }\FunctionTok{nrow}\NormalTok{(test\_reg),  }\StringTok{"rows,"}\NormalTok{, }\FunctionTok{ncol}\NormalTok{(test\_reg),  }\StringTok{"columns}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Test : 45725 rows, 19 columns
\end{verbatim}

\subsection{11. Modelling}\label{modelling}

This section develops models for both tasks. For classification, two
ensemble approaches are compared: LightGBM trained on SMOTE-balanced
data and XGBoost trained on original data with class weighting. For
regression, a Random Forest (Ranger) model and an XGBoost regression
model are trained and evaluated using standard regression metrics.

\subsubsection{11A. Classification
Modelling}\label{a.-classification-modelling}

\paragraph{11A.1 Modelling Strategy}\label{a.1-modelling-strategy}

The classification pipeline uses two imbalance-handling strategies: -
\textbf{SMOTE} is applied to the training data for LightGBM to reduce
class imbalance. - \textbf{Class weighting (scale\_pos\_weight)} is used
for XGBoost without SMOTE to preserve the original data distribution.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(lightgbm)}
\FunctionTok{library}\NormalTok{(ParBayesianOptimization)}
\FunctionTok{library}\NormalTok{(Matrix)}
\FunctionTok{library}\NormalTok{(smotefamily)}
\FunctionTok{library}\NormalTok{(pROC)}
\FunctionTok{library}\NormalTok{(caret)}
\FunctionTok{library}\NormalTok{(xgboost)}
\end{Highlighting}
\end{Shaded}

\paragraph{11A.2 Data Preparation for
Modelling}\label{a.2-data-preparation-for-modelling}

The response variable is converted into numeric form (0/1) for model
training. All predictors are one-hot encoded
using\texttt{model.matrix()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{train\_y\_num }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(train\_clf}\SpecialCharTok{$}\NormalTok{HeartDisease }\SpecialCharTok{==} \StringTok{"Yes"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{valid\_y\_num }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(valid\_clf}\SpecialCharTok{$}\NormalTok{HeartDisease }\SpecialCharTok{==} \StringTok{"Yes"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{test\_y\_num  }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(test\_clf}\SpecialCharTok{$}\NormalTok{HeartDisease  }\SpecialCharTok{==} \StringTok{"Yes"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}

\NormalTok{X\_train }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(HeartDisease }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., train\_clf)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{X\_valid }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(HeartDisease }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., valid\_clf)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{X\_test  }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(HeartDisease }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., test\_clf)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\paragraph{11A.3 LightGBM with SMOTE + Bayesian
Optimization}\label{a.3-lightgbm-with-smote-bayesian-optimization}

SMOTE is applied to the training data only. Bayesian Optimization is
used to tune key LightGBM hyperparameters using validation AUC.

\subparagraph{11A.3.1 Apply SMOTE (Training Set
Only)}\label{a.3.1-apply-smote-training-set-only}

SMOTE is applied only to the training data to reduce class imbalance
without leaking information into validation or test sets.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{{-}{-}{-} Running SMOTE on training data {-}{-}{-}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## --- Running SMOTE on training data ---
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{df\_smote\_X }\OtherTok{\textless{}{-}} \FunctionTok{as.data.frame}\NormalTok{(X\_train)}
\NormalTok{df\_smote\_y }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(train\_y\_num, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{))}

\NormalTok{smote\_out }\OtherTok{\textless{}{-}} \FunctionTok{SMOTE}\NormalTok{(}
\NormalTok{  df\_smote\_X,}
\NormalTok{  df\_smote\_y,}
  \AttributeTok{K =} \DecValTok{5}\NormalTok{,}
  \AttributeTok{dup\_size =} \DecValTok{3}
\NormalTok{)}

\NormalTok{X\_train\_smote }\OtherTok{\textless{}{-}} \FunctionTok{as.matrix}\NormalTok{(smote\_out}\SpecialCharTok{$}\NormalTok{data[, }\SpecialCharTok{{-}}\FunctionTok{ncol}\NormalTok{(smote\_out}\SpecialCharTok{$}\NormalTok{data)])}
\NormalTok{y\_train\_smote }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{as.character}\NormalTok{(smote\_out}\SpecialCharTok{$}\NormalTok{data}\SpecialCharTok{$}\NormalTok{class))}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Original distribution:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Original distribution:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{table}\NormalTok{(train\_y\_num))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## train_y_num
##      0      1 
## 123042  14133
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{After SMOTE:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## After SMOTE:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{table}\NormalTok{(y\_train\_smote))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## y_train_smote
##      0      1 
## 123042  56532
\end{verbatim}

\subparagraph{11A.3.2 Create LightGBM
Datasets}\label{a.3.2-create-lightgbm-datasets}

LightGBM datasets are created for training and validation in preparation
for hyperparameter tuning.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dtrain }\OtherTok{\textless{}{-}} \FunctionTok{lgb.Dataset}\NormalTok{(}
  \AttributeTok{data =}\NormalTok{ X\_train\_smote,}
  \AttributeTok{label =}\NormalTok{ y\_train\_smote}
\NormalTok{)}

\NormalTok{dvalid }\OtherTok{\textless{}{-}} \FunctionTok{lgb.Dataset.create.valid}\NormalTok{(}
\NormalTok{  dtrain,}
  \AttributeTok{data =} \FunctionTok{as.matrix}\NormalTok{(X\_valid),}
  \AttributeTok{label =}\NormalTok{ valid\_y\_num}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\subparagraph{11A.3.3 Bayesian Optimization for LightGBM
(AUC)}\label{a.3.3-bayesian-optimization-for-lightgbm-auc}

Bayesian Optimization is used to tune key LightGBM hyperparameters. The
objective is to maximize validation AUC with early stopping.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lgb\_bayes }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(learning\_rate, num\_leaves, feature\_fraction,}
\NormalTok{                      bagging\_fraction, min\_data\_in\_leaf) \{}
  
\NormalTok{  params }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{objective =} \StringTok{"binary"}\NormalTok{,}
    \AttributeTok{metric =} \StringTok{"auc"}\NormalTok{,}
    \AttributeTok{learning\_rate =}\NormalTok{ learning\_rate,}
    \AttributeTok{num\_leaves =} \FunctionTok{as.integer}\NormalTok{(num\_leaves),}
    \AttributeTok{feature\_fraction =}\NormalTok{ feature\_fraction,}
    \AttributeTok{bagging\_fraction =}\NormalTok{ bagging\_fraction,}
    \AttributeTok{bagging\_freq =} \DecValTok{5}\NormalTok{,}
    \AttributeTok{min\_data\_in\_leaf =} \FunctionTok{as.integer}\NormalTok{(min\_data\_in\_leaf),}
    
    \CommentTok{\# IMPORTANT FIX}
    \AttributeTok{feature\_pre\_filter =} \ConstantTok{FALSE}\NormalTok{,}
    \AttributeTok{force\_row\_wise =} \ConstantTok{TRUE}\NormalTok{,    }
    \AttributeTok{verbosity =} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{  )}
  
\NormalTok{  model }\OtherTok{\textless{}{-}} \FunctionTok{lgb.train}\NormalTok{(}
    \AttributeTok{params =}\NormalTok{ params,}
    \AttributeTok{data =}\NormalTok{ dtrain,}
    \AttributeTok{valids =} \FunctionTok{list}\NormalTok{(}\AttributeTok{valid =}\NormalTok{ dvalid),}
    \AttributeTok{nrounds =} \DecValTok{500}\NormalTok{,}
    \AttributeTok{early\_stopping\_rounds =} \DecValTok{30}\NormalTok{,}
    \AttributeTok{verbose =} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{  )}
  
\NormalTok{  best\_auc }\OtherTok{\textless{}{-}} \FunctionTok{max}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(model}\SpecialCharTok{$}\NormalTok{record\_evals}\SpecialCharTok{$}\NormalTok{valid}\SpecialCharTok{$}\NormalTok{auc}\SpecialCharTok{$}\NormalTok{eval))}
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{Score =}\NormalTok{ best\_auc))}
\NormalTok{\}}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}

\NormalTok{opt\_results }\OtherTok{\textless{}{-}} \FunctionTok{bayesOpt}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ lgb\_bayes,}
  \AttributeTok{bounds =} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{learning\_rate =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
    \AttributeTok{num\_leaves =} \FunctionTok{c}\NormalTok{(}\DecValTok{20}\DataTypeTok{L}\NormalTok{, }\DecValTok{80}\DataTypeTok{L}\NormalTok{),}
    \AttributeTok{feature\_fraction =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.6}\NormalTok{, }\FloatTok{1.0}\NormalTok{),}
    \AttributeTok{bagging\_fraction =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.6}\NormalTok{, }\FloatTok{1.0}\NormalTok{),}
    \AttributeTok{min\_data\_in\_leaf =} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\DataTypeTok{L}\NormalTok{, }\DecValTok{80}\DataTypeTok{L}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{initPoints =} \DecValTok{8}\NormalTok{,   }
  \AttributeTok{iters.n =} \DecValTok{20}\NormalTok{,}
  \AttributeTok{acq =} \StringTok{"ucb"}\NormalTok{,}
  \AttributeTok{kappa =} \FloatTok{2.5}\NormalTok{,}
  \AttributeTok{parallel =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{verbose =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Running initial scoring function 8 times in 1 thread(s)...
\end{verbatim}

\begin{verbatim}
##         8.61 seconds
##   3) Running FUN 1 times in 1 thread(s)...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{========== BEST BAYESIAN OPT PARAMETERS ==========}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## ========== BEST BAYESIAN OPT PARAMETERS ==========
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(}\FunctionTok{getBestPars}\NormalTok{(opt\_results))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $learning_rate
## [1] 0.08516086
## 
## $num_leaves
## [1] 20
## 
## $feature_fraction
## [1] 0.8480176
## 
## $bagging_fraction
## [1] 0.6
## 
## $min_data_in_leaf
## [1] 54
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best\_params }\OtherTok{\textless{}{-}} \FunctionTok{getBestPars}\NormalTok{(opt\_results)}
\end{Highlighting}
\end{Shaded}

\subparagraph{11A.3.4 Train Final LightGBM and Evaluate on Test
Set}\label{a.3.4-train-final-lightgbm-and-evaluate-on-test-set}

The final model is trained using optimized hyperparameters and evaluated
on the test set using Accuracy, Precision, Recall, F1-score, and AUC.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{final\_params }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{objective =} \StringTok{"binary"}\NormalTok{,}
  \AttributeTok{metric =} \StringTok{"auc"}\NormalTok{,}
  \AttributeTok{learning\_rate =}\NormalTok{ best\_params}\SpecialCharTok{$}\NormalTok{learning\_rate,}
  \AttributeTok{num\_leaves =} \FunctionTok{as.integer}\NormalTok{(best\_params}\SpecialCharTok{$}\NormalTok{num\_leaves),}
  \AttributeTok{feature\_fraction =}\NormalTok{ best\_params}\SpecialCharTok{$}\NormalTok{feature\_fraction,}
  \AttributeTok{bagging\_fraction =}\NormalTok{ best\_params}\SpecialCharTok{$}\NormalTok{bagging\_fraction,}
  \AttributeTok{bagging\_freq =} \DecValTok{5}\NormalTok{,}
  \AttributeTok{min\_data\_in\_leaf =} \FunctionTok{as.integer}\NormalTok{(best\_params}\SpecialCharTok{$}\NormalTok{min\_data\_in\_leaf),}
  \AttributeTok{feature\_pre\_filter =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{force\_row\_wise =} \ConstantTok{TRUE}\NormalTok{,}
  \AttributeTok{verbosity =} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{)}

\NormalTok{final\_model }\OtherTok{\textless{}{-}} \FunctionTok{lgb.train}\NormalTok{(}
  \AttributeTok{params =}\NormalTok{ final\_params,}
  \AttributeTok{data =}\NormalTok{ dtrain,}
  \AttributeTok{valids =} \FunctionTok{list}\NormalTok{(}\AttributeTok{valid =}\NormalTok{ dvalid),}
  \AttributeTok{nrounds =} \DecValTok{700}\NormalTok{,}
  \AttributeTok{early\_stopping\_rounds =} \DecValTok{40}\NormalTok{,}
  \AttributeTok{verbose =} \DecValTok{1}
\NormalTok{)}

\NormalTok{pred\_prob }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(final\_model, }\FunctionTok{as.matrix}\NormalTok{(X\_test))}
\NormalTok{pred }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(pred\_prob }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}

\NormalTok{pred\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(pred, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\NormalTok{test\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(test\_y\_num, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{))}

\NormalTok{conf }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{Predicted =}\NormalTok{ pred\_factor, }\AttributeTok{Actual =}\NormalTok{ test\_factor)}

\NormalTok{acc }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(pred }\SpecialCharTok{==}\NormalTok{ test\_y\_num)}
\NormalTok{prec }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{precision}\NormalTok{(pred\_factor, test\_factor)}
\NormalTok{rec }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{recall}\NormalTok{(pred\_factor, test\_factor)}
\NormalTok{f1 }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{F\_meas}\NormalTok{(pred\_factor, test\_factor)}
\NormalTok{auc }\OtherTok{\textless{}{-}} \FunctionTok{auc}\NormalTok{(test\_y\_num, pred\_prob)}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{================ FINAL LIGHTGBM PERFORMANCE ================}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## ================ FINAL LIGHTGBM PERFORMANCE ================
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(conf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          Actual
## Predicted     0     1
##         0 40109  4084
##         1   814   718
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}
  \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Accuracy: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{Precision: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{Recall: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{F1 Score: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{AUC: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
\NormalTok{  acc, prec, rec, f1, auc}
\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Accuracy: 0.8929
## Precision: 0.9076
## Recall: 0.9801
## F1 Score: 0.9425
## AUC: 0.8218
\end{verbatim}

\paragraph{11A.4 XGBoost with Class Weighting + Bayesian
Optimization}\label{a.4-xgboost-with-class-weighting-bayesian-optimization}

XGBoost is tuned using Bayesian Optimization, using class weighting to
address imbalance without resampling.

\subparagraph{11A.4.1 Prepare DMatrix and Class
Weight}\label{a.4.1-prepare-dmatrix-and-class-weight}

XGBoost is trained using the original (unbalanced) training data. Class
imbalance is handled using \texttt{scale\_pos\_weight}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dtrain\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{xgb.DMatrix}\NormalTok{(}\AttributeTok{data =}\NormalTok{ X\_train, }\AttributeTok{label =}\NormalTok{ train\_y\_num)}
\NormalTok{dvalid\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{xgb.DMatrix}\NormalTok{(}\AttributeTok{data =}\NormalTok{ X\_valid, }\AttributeTok{label =}\NormalTok{ valid\_y\_num)}
\NormalTok{dtest\_xgb  }\OtherTok{\textless{}{-}} \FunctionTok{xgb.DMatrix}\NormalTok{(}\AttributeTok{data =}\NormalTok{ X\_test,  }\AttributeTok{label =}\NormalTok{ test\_y\_num)}

\NormalTok{scale\_pos\_weight\_val }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(train\_y\_num }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(train\_y\_num }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\NormalTok{scale\_pos\_weight\_val}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8.706007
\end{verbatim}

\subparagraph{11A.4.2 Bayesian Optimization for XGBoost
(AUC)}\label{a.4.2-bayesian-optimization-for-xgboost-auc}

Bayesian Optimization is used to tune XGBoost hyperparameters by
maximizing validation AUC.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xgb\_bayes }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(eta, max\_depth, subsample,}
\NormalTok{                      colsample\_bytree, min\_child\_weight) \{}
  
\NormalTok{  params }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{objective =} \StringTok{"binary:logistic"}\NormalTok{,}
    \AttributeTok{eval\_metric =} \StringTok{"auc"}\NormalTok{,}
    \AttributeTok{eta =}\NormalTok{ eta,}
    \AttributeTok{max\_depth =} \FunctionTok{as.integer}\NormalTok{(max\_depth),}
    \AttributeTok{subsample =}\NormalTok{ subsample,}
    \AttributeTok{colsample\_bytree =}\NormalTok{ colsample\_bytree,}
    \AttributeTok{min\_child\_weight =}\NormalTok{ min\_child\_weight,}
    \AttributeTok{scale\_pos\_weight =}\NormalTok{ scale\_pos\_weight\_val,}
    \AttributeTok{tree\_method =} \StringTok{"hist"}\NormalTok{,}
    \AttributeTok{booster =} \StringTok{"gbtree"}
\NormalTok{  )}
  
\NormalTok{  model }\OtherTok{\textless{}{-}} \FunctionTok{tryCatch}\NormalTok{(\{}
    \FunctionTok{xgb.train}\NormalTok{(}
      \AttributeTok{params =}\NormalTok{ params,}
      \AttributeTok{data =}\NormalTok{ dtrain\_xgb,}
      \AttributeTok{nrounds =} \DecValTok{500}\NormalTok{,}
      \AttributeTok{watchlist =} \FunctionTok{list}\NormalTok{(}\AttributeTok{valid =}\NormalTok{ dvalid\_xgb),}
      \AttributeTok{early\_stopping\_rounds =} \DecValTok{20}\NormalTok{,}
      \AttributeTok{verbose =} \DecValTok{0}
\NormalTok{    )}
\NormalTok{  \}, }\AttributeTok{error =} \ControlFlowTok{function}\NormalTok{(e) }\ConstantTok{NULL}\NormalTok{)}
  
  \CommentTok{\#  HARD FAIL SAFE}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.null}\NormalTok{(model)) \{}
    \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{Score =} \FloatTok{0.5}\NormalTok{))}
\NormalTok{  \}}
  
\NormalTok{  best\_auc }\OtherTok{\textless{}{-}} \FunctionTok{suppressWarnings}\NormalTok{(}
    \FunctionTok{max}\NormalTok{(model}\SpecialCharTok{$}\NormalTok{evaluation\_log}\SpecialCharTok{$}\NormalTok{valid\_auc, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
  
  \CommentTok{\# Prevent NA / Inf / constant collapse}
  \ControlFlowTok{if}\NormalTok{ (}\SpecialCharTok{!}\FunctionTok{is.finite}\NormalTok{(best\_auc)) \{}
\NormalTok{    best\_auc }\OtherTok{\textless{}{-}} \FloatTok{0.5}
\NormalTok{  \}}
  
  \CommentTok{\# Add microscopic noise to prevent GP zero{-}variance}
\NormalTok{  best\_auc }\OtherTok{\textless{}{-}}\NormalTok{ best\_auc }\SpecialCharTok{+} \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\FloatTok{1e{-}6}\NormalTok{)}
  
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{Score =}\NormalTok{ best\_auc))}
\NormalTok{\}}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}

\NormalTok{opt\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{bayesOpt}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ xgb\_bayes,}
  \AttributeTok{bounds =} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{eta =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.01}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
    \AttributeTok{max\_depth =} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\DataTypeTok{L}\NormalTok{, }\DecValTok{10}\DataTypeTok{L}\NormalTok{),}
    \AttributeTok{subsample =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{1.0}\NormalTok{),}
    \AttributeTok{colsample\_bytree =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{1.0}\NormalTok{),}
    \AttributeTok{min\_child\_weight =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{initPoints =} \DecValTok{12}\NormalTok{,     }
  \AttributeTok{iters.n =} \DecValTok{20}\NormalTok{,}
  \AttributeTok{acq =} \StringTok{"ucb"}\NormalTok{,}
  \AttributeTok{kappa =} \FloatTok{2.5}\NormalTok{,}
  \AttributeTok{verbose =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Running initial scoring function 12 times in 1 thread(s)...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best\_xgb\_params }\OtherTok{\textless{}{-}} \FunctionTok{getBestPars}\NormalTok{(opt\_xgb)}
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Best XGB Params:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Best XGB Params:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(best\_xgb\_params)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $eta
## [1] 0.02104175
## 
## $max_depth
## [1] 5
## 
## $subsample
## [1] 0.7285954
## 
## $colsample_bytree
## [1] 0.7966621
## 
## $min_child_weight
## [1] 2.903258
\end{verbatim}

\subparagraph{11A.4.3 Train Final XGBoost and Evaluate on Test
Set}\label{a.4.3-train-final-xgboost-and-evaluate-on-test-set}

The final tuned XGBoost model is trained and evaluated using the same
classification metrics.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{final\_xgb\_params }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{objective =} \StringTok{"binary:logistic"}\NormalTok{,}
  \AttributeTok{eval\_metric =} \StringTok{"auc"}\NormalTok{,}
  \AttributeTok{eta =}\NormalTok{ best\_xgb\_params}\SpecialCharTok{$}\NormalTok{eta,}
  \AttributeTok{max\_depth =} \FunctionTok{as.integer}\NormalTok{(best\_xgb\_params}\SpecialCharTok{$}\NormalTok{max\_depth),}
  \AttributeTok{subsample =}\NormalTok{ best\_xgb\_params}\SpecialCharTok{$}\NormalTok{subsample,}
  \AttributeTok{colsample\_bytree =}\NormalTok{ best\_xgb\_params}\SpecialCharTok{$}\NormalTok{colsample\_bytree,}
  \AttributeTok{min\_child\_weight =}\NormalTok{ best\_xgb\_params}\SpecialCharTok{$}\NormalTok{min\_child\_weight,}
  \AttributeTok{scale\_pos\_weight =}\NormalTok{ scale\_pos\_weight\_val,}
  \AttributeTok{tree\_method =} \StringTok{"hist"}\NormalTok{,}
  \AttributeTok{booster =} \StringTok{"gbtree"}
\NormalTok{)}

\NormalTok{xgb\_clf }\OtherTok{\textless{}{-}} \FunctionTok{xgb.train}\NormalTok{(}
  \AttributeTok{params =}\NormalTok{ final\_xgb\_params,}
  \AttributeTok{data =}\NormalTok{ dtrain\_xgb,}
  \AttributeTok{nrounds =} \DecValTok{700}\NormalTok{,}
  \AttributeTok{watchlist =} \FunctionTok{list}\NormalTok{(}\AttributeTok{valid =}\NormalTok{ dvalid\_xgb),}
  \AttributeTok{early\_stopping\_rounds =} \DecValTok{30}\NormalTok{,}
  \AttributeTok{verbose =} \DecValTok{1}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  valid-auc:0.786557 
## Will train until valid_auc hasn't improved in 30 rounds.
## 
## [2]  valid-auc:0.809775 
## [3]  valid-auc:0.813197 
## [4]  valid-auc:0.815307 
## [5]  valid-auc:0.816428 
## [6]  valid-auc:0.816590 
## [7]  valid-auc:0.815620 
## [8]  valid-auc:0.815315 
## [9]  valid-auc:0.816220 
## [10] valid-auc:0.818043 
## [11] valid-auc:0.818553 
## [12] valid-auc:0.819211 
## [13] valid-auc:0.819434 
## [14] valid-auc:0.819427 
## [15] valid-auc:0.819460 
## [16] valid-auc:0.819856 
## [17] valid-auc:0.820071 
## [18] valid-auc:0.820679 
## [19] valid-auc:0.820826 
## [20] valid-auc:0.820902 
## [21] valid-auc:0.821009 
## [22] valid-auc:0.821158 
## [23] valid-auc:0.821121 
## [24] valid-auc:0.821341 
## [25] valid-auc:0.821540 
## [26] valid-auc:0.821547 
## [27] valid-auc:0.821668 
## [28] valid-auc:0.821620 
## [29] valid-auc:0.821525 
## [30] valid-auc:0.821633 
## [31] valid-auc:0.821746 
## [32] valid-auc:0.821865 
## [33] valid-auc:0.822057 
## [34] valid-auc:0.822210 
## [35] valid-auc:0.822308 
## [36] valid-auc:0.822403 
## [37] valid-auc:0.822524 
## [38] valid-auc:0.822676 
## [39] valid-auc:0.822801 
## [40] valid-auc:0.822834 
## [41] valid-auc:0.822938 
## [42] valid-auc:0.822936 
## [43] valid-auc:0.823002 
## [44] valid-auc:0.823104 
## [45] valid-auc:0.823086 
## [46] valid-auc:0.823149 
## [47] valid-auc:0.823153 
## [48] valid-auc:0.823212 
## [49] valid-auc:0.823248 
## [50] valid-auc:0.823429 
## [51] valid-auc:0.823490 
## [52] valid-auc:0.823483 
## [53] valid-auc:0.823581 
## [54] valid-auc:0.823629 
## [55] valid-auc:0.823646 
## [56] valid-auc:0.823751 
## [57] valid-auc:0.823821 
## [58] valid-auc:0.823854 
## [59] valid-auc:0.823955 
## [60] valid-auc:0.824017 
## [61] valid-auc:0.824132 
## [62] valid-auc:0.824182 
## [63] valid-auc:0.824185 
## [64] valid-auc:0.824243 
## [65] valid-auc:0.824318 
## [66] valid-auc:0.824412 
## [67] valid-auc:0.824478 
## [68] valid-auc:0.824629 
## [69] valid-auc:0.824659 
## [70] valid-auc:0.824749 
## [71] valid-auc:0.824800 
## [72] valid-auc:0.824848 
## [73] valid-auc:0.824906 
## [74] valid-auc:0.824935 
## [75] valid-auc:0.825057 
## [76] valid-auc:0.825081 
## [77] valid-auc:0.825175 
## [78] valid-auc:0.825203 
## [79] valid-auc:0.825246 
## [80] valid-auc:0.825285 
## [81] valid-auc:0.825358 
## [82] valid-auc:0.825392 
## [83] valid-auc:0.825413 
## [84] valid-auc:0.825472 
## [85] valid-auc:0.825511 
## [86] valid-auc:0.825567 
## [87] valid-auc:0.825634 
## [88] valid-auc:0.825666 
## [89] valid-auc:0.825705 
## [90] valid-auc:0.825677 
## [91] valid-auc:0.825731 
## [92] valid-auc:0.825747 
## [93] valid-auc:0.825742 
## [94] valid-auc:0.825748 
## [95] valid-auc:0.825833 
## [96] valid-auc:0.825857 
## [97] valid-auc:0.825880 
## [98] valid-auc:0.825901 
## [99] valid-auc:0.825935 
## [100]    valid-auc:0.825966 
## [101]    valid-auc:0.825994 
## [102]    valid-auc:0.826045 
## [103]    valid-auc:0.826077 
## [104]    valid-auc:0.826099 
## [105]    valid-auc:0.826140 
## [106]    valid-auc:0.826157 
## [107]    valid-auc:0.826179 
## [108]    valid-auc:0.826188 
## [109]    valid-auc:0.826213 
## [110]    valid-auc:0.826198 
## [111]    valid-auc:0.826215 
## [112]    valid-auc:0.826247 
## [113]    valid-auc:0.826267 
## [114]    valid-auc:0.826294 
## [115]    valid-auc:0.826327 
## [116]    valid-auc:0.826336 
## [117]    valid-auc:0.826361 
## [118]    valid-auc:0.826399 
## [119]    valid-auc:0.826425 
## [120]    valid-auc:0.826458 
## [121]    valid-auc:0.826462 
## [122]    valid-auc:0.826475 
## [123]    valid-auc:0.826461 
## [124]    valid-auc:0.826473 
## [125]    valid-auc:0.826507 
## [126]    valid-auc:0.826519 
## [127]    valid-auc:0.826514 
## [128]    valid-auc:0.826515 
## [129]    valid-auc:0.826541 
## [130]    valid-auc:0.826578 
## [131]    valid-auc:0.826594 
## [132]    valid-auc:0.826597 
## [133]    valid-auc:0.826607 
## [134]    valid-auc:0.826631 
## [135]    valid-auc:0.826625 
## [136]    valid-auc:0.826636 
## [137]    valid-auc:0.826673 
## [138]    valid-auc:0.826677 
## [139]    valid-auc:0.826664 
## [140]    valid-auc:0.826684 
## [141]    valid-auc:0.826700 
## [142]    valid-auc:0.826723 
## [143]    valid-auc:0.826763 
## [144]    valid-auc:0.826764 
## [145]    valid-auc:0.826789 
## [146]    valid-auc:0.826815 
## [147]    valid-auc:0.826830 
## [148]    valid-auc:0.826824 
## [149]    valid-auc:0.826833 
## [150]    valid-auc:0.826851 
## [151]    valid-auc:0.826842 
## [152]    valid-auc:0.826859 
## [153]    valid-auc:0.826860 
## [154]    valid-auc:0.826876 
## [155]    valid-auc:0.826897 
## [156]    valid-auc:0.826916 
## [157]    valid-auc:0.826911 
## [158]    valid-auc:0.826930 
## [159]    valid-auc:0.826959 
## [160]    valid-auc:0.826973 
## [161]    valid-auc:0.826984 
## [162]    valid-auc:0.826983 
## [163]    valid-auc:0.826976 
## [164]    valid-auc:0.826973 
## [165]    valid-auc:0.826982 
## [166]    valid-auc:0.826996 
## [167]    valid-auc:0.827004 
## [168]    valid-auc:0.826991 
## [169]    valid-auc:0.827001 
## [170]    valid-auc:0.827011 
## [171]    valid-auc:0.827034 
## [172]    valid-auc:0.827034 
## [173]    valid-auc:0.827036 
## [174]    valid-auc:0.827045 
## [175]    valid-auc:0.827063 
## [176]    valid-auc:0.827071 
## [177]    valid-auc:0.827057 
## [178]    valid-auc:0.827061 
## [179]    valid-auc:0.827058 
## [180]    valid-auc:0.827076 
## [181]    valid-auc:0.827075 
## [182]    valid-auc:0.827092 
## [183]    valid-auc:0.827087 
## [184]    valid-auc:0.827099 
## [185]    valid-auc:0.827106 
## [186]    valid-auc:0.827113 
## [187]    valid-auc:0.827112 
## [188]    valid-auc:0.827128 
## [189]    valid-auc:0.827110 
## [190]    valid-auc:0.827107 
## [191]    valid-auc:0.827105 
## [192]    valid-auc:0.827105 
## [193]    valid-auc:0.827116 
## [194]    valid-auc:0.827117 
## [195]    valid-auc:0.827125 
## [196]    valid-auc:0.827135 
## [197]    valid-auc:0.827137 
## [198]    valid-auc:0.827157 
## [199]    valid-auc:0.827175 
## [200]    valid-auc:0.827183 
## [201]    valid-auc:0.827190 
## [202]    valid-auc:0.827192 
## [203]    valid-auc:0.827199 
## [204]    valid-auc:0.827203 
## [205]    valid-auc:0.827212 
## [206]    valid-auc:0.827219 
## [207]    valid-auc:0.827220 
## [208]    valid-auc:0.827216 
## [209]    valid-auc:0.827232 
## [210]    valid-auc:0.827245 
## [211]    valid-auc:0.827250 
## [212]    valid-auc:0.827255 
## [213]    valid-auc:0.827263 
## [214]    valid-auc:0.827259 
## [215]    valid-auc:0.827252 
## [216]    valid-auc:0.827249 
## [217]    valid-auc:0.827244 
## [218]    valid-auc:0.827250 
## [219]    valid-auc:0.827247 
## [220]    valid-auc:0.827256 
## [221]    valid-auc:0.827261 
## [222]    valid-auc:0.827275 
## [223]    valid-auc:0.827269 
## [224]    valid-auc:0.827264 
## [225]    valid-auc:0.827274 
## [226]    valid-auc:0.827282 
## [227]    valid-auc:0.827262 
## [228]    valid-auc:0.827265 
## [229]    valid-auc:0.827246 
## [230]    valid-auc:0.827246 
## [231]    valid-auc:0.827249 
## [232]    valid-auc:0.827246 
## [233]    valid-auc:0.827240 
## [234]    valid-auc:0.827233 
## [235]    valid-auc:0.827243 
## [236]    valid-auc:0.827264 
## [237]    valid-auc:0.827261 
## [238]    valid-auc:0.827250 
## [239]    valid-auc:0.827245 
## [240]    valid-auc:0.827253 
## [241]    valid-auc:0.827255 
## [242]    valid-auc:0.827265 
## [243]    valid-auc:0.827270 
## [244]    valid-auc:0.827262 
## [245]    valid-auc:0.827259 
## [246]    valid-auc:0.827262 
## [247]    valid-auc:0.827254 
## [248]    valid-auc:0.827244 
## [249]    valid-auc:0.827250 
## [250]    valid-auc:0.827249 
## [251]    valid-auc:0.827232 
## [252]    valid-auc:0.827229 
## [253]    valid-auc:0.827226 
## [254]    valid-auc:0.827225 
## [255]    valid-auc:0.827230 
## [256]    valid-auc:0.827237 
## Stopping. Best iteration:
## [226]    valid-auc:0.827282
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pred\_prob\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(xgb\_clf, dtest\_xgb)}
\NormalTok{pred\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(pred\_prob\_xgb }\SpecialCharTok{\textgreater{}} \FloatTok{0.5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}

\NormalTok{pred\_xgb\_factor }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(pred\_xgb, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{))}
\NormalTok{test\_factor\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(test\_y\_num, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{))}

\NormalTok{xgb\_conf }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{Predicted =}\NormalTok{ pred\_xgb\_factor, }\AttributeTok{Actual =}\NormalTok{ test\_factor\_xgb)}

\NormalTok{xgb\_acc  }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(pred\_xgb }\SpecialCharTok{==}\NormalTok{ test\_y\_num)}
\NormalTok{xgb\_prec }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{precision}\NormalTok{(pred\_xgb\_factor, test\_factor\_xgb)}
\NormalTok{xgb\_rec  }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{recall}\NormalTok{(pred\_xgb\_factor, test\_factor\_xgb)}
\NormalTok{xgb\_f1   }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{F\_meas}\NormalTok{(pred\_xgb\_factor, test\_factor\_xgb)}
\NormalTok{xgb\_auc  }\OtherTok{\textless{}{-}} \FunctionTok{auc}\NormalTok{(test\_y\_num, pred\_prob\_xgb)}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{XGBoost Confusion Matrix:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## XGBoost Confusion Matrix:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(xgb\_conf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##          Actual
## Predicted     0     1
##         0 28691   970
##         1 12232  3832
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}
  \StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{XGBoost Accuracy: \%.4f | Precision: \%.4f | Recall: \%.4f | F1: \%.4f | AUC: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
\NormalTok{  xgb\_acc, xgb\_prec, xgb\_rec, xgb\_f1, xgb\_auc}
\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## XGBoost Accuracy: 0.7113 | Precision: 0.9673 | Recall: 0.7011 | F1: 0.8130 | AUC: 0.8246
\end{verbatim}

\subsubsection{11B. Regression Modelling}\label{b.-regression-modelling}

This section develops regression models to predict \textbf{BMI} as a
continuous outcome. Two ensemble approaches are evaluated: 1.
\textbf{Random Forest Regression (Ranger)} tuned using Bayesian
Optimization. 2. \textbf{XGBoost Regression} tuned using Random Search
with cross-validation.

Both models are evaluated on the test set using RMSE, MAE, MAPE, RÂ², and
Adjusted RÂ².

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ranger)}
\FunctionTok{library}\NormalTok{(Metrics)}
\FunctionTok{library}\NormalTok{(ParBayesianOptimization)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(xgboost)}
\end{Highlighting}
\end{Shaded}

\paragraph{Classification Summary}\label{classification-summary}

\paragraph{11B.1 Random Forest Regression (Ranger) with Bayesian
Optimization}\label{b.1-random-forest-regression-ranger-with-bayesian-optimization}

\subparagraph{11B.1.1 Evaluation Metric
Definition}\label{b.1.1-evaluation-metric-definition}

Adjusted RÂ² is included to account for the number of predictors used in
the model.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{adj\_r2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(y\_true, y\_pred, p) \{}
\NormalTok{  r2\_val }\OtherTok{\textless{}{-}}\NormalTok{ Metrics}\SpecialCharTok{::}\FunctionTok{r2}\NormalTok{(y\_true, y\_pred)}
\NormalTok{  n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(y\_true)}
  \FunctionTok{return}\NormalTok{(}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ r2\_val) }\SpecialCharTok{*}\NormalTok{ ((n }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ p }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)))}
\NormalTok{\}}

\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(train\_reg) }\SpecialCharTok{{-}} \DecValTok{1} 
\end{Highlighting}
\end{Shaded}

\subparagraph{11B.1.2 Bayesian Optimization for Ranger (Validation
RMSE)}\label{b.1.2-bayesian-optimization-for-ranger-validation-rmse}

Bayesian Optimization is used to tune \texttt{mtry},
\texttt{min.node.size}, and \texttt{sample.fraction}. The optimization
objective is to minimize validation RMSE.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf\_bayes }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(mtry, min\_node\_size, sample\_fraction) \{}
  
\NormalTok{  model }\OtherTok{\textless{}{-}} \FunctionTok{ranger}\NormalTok{(}
\NormalTok{    BMI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .,}
    \AttributeTok{data =}\NormalTok{ train\_reg,}
    \AttributeTok{num.trees =} \DecValTok{500}\NormalTok{,}
    \AttributeTok{mtry =} \FunctionTok{as.integer}\NormalTok{(mtry),}
    \AttributeTok{min.node.size =} \FunctionTok{as.integer}\NormalTok{(min\_node\_size),}
    \AttributeTok{sample.fraction =}\NormalTok{ sample\_fraction,}
    \AttributeTok{importance =} \StringTok{"impurity"}
\NormalTok{  )}
  
\NormalTok{  pred\_valid }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(model, }\AttributeTok{data =}\NormalTok{ valid\_reg)}\SpecialCharTok{$}\NormalTok{predictions}
\NormalTok{  rmse\_valid }\OtherTok{\textless{}{-}}\NormalTok{ Metrics}\SpecialCharTok{::}\FunctionTok{rmse}\NormalTok{(valid\_reg}\SpecialCharTok{$}\NormalTok{BMI, pred\_valid)}
  
  \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{Score =} \SpecialCharTok{{-}}\NormalTok{rmse\_valid))  }
\NormalTok{\}}

\FunctionTok{cat}\NormalTok{(}\StringTok{"Running Bayesian Optimization for Ranger...}\SpecialCharTok{\textbackslash{}n\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Running Bayesian Optimization for Ranger...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{opt\_results\_rf }\OtherTok{\textless{}{-}} \FunctionTok{bayesOpt}\NormalTok{(}
  \AttributeTok{FUN =}\NormalTok{ rf\_bayes,}
  \AttributeTok{bounds =} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{mtry =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\DataTypeTok{L}\NormalTok{, }\DecValTok{15}\DataTypeTok{L}\NormalTok{),}
    \AttributeTok{min\_node\_size =} \FunctionTok{c}\NormalTok{(}\DecValTok{2}\DataTypeTok{L}\NormalTok{, }\DecValTok{20}\DataTypeTok{L}\NormalTok{),}
    \AttributeTok{sample\_fraction =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{1.0}\NormalTok{)}
\NormalTok{  ),}
  \AttributeTok{initPoints =} \DecValTok{8}\NormalTok{,}
  \AttributeTok{iters.n =} \DecValTok{20}\NormalTok{,}
  \AttributeTok{acq =} \StringTok{"ucb"}\NormalTok{,}
  \AttributeTok{kappa =} \FloatTok{2.5}\NormalTok{,}
  \AttributeTok{verbose =} \ConstantTok{TRUE}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Running initial scoring function 8 times in 1 thread(s)...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best\_params\_rf }\OtherTok{\textless{}{-}} \FunctionTok{getBestPars}\NormalTok{(opt\_results\_rf)}
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Best Ranger Parameters:}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Best Ranger Parameters:
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(best\_params\_rf)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $mtry
## [1] 3
## 
## $min_node_size
## [1] 20
## 
## $sample_fraction
## [1] 0.5
\end{verbatim}

\subparagraph{11B.1.3 Train Final Ranger Model and Evaluate on Test
Set}\label{b.1.3-train-final-ranger-model-and-evaluate-on-test-set}

The final tuned Random Forest regression model is trained and evaluated
using standard regression metrics.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rf\_model\_final }\OtherTok{\textless{}{-}} \FunctionTok{ranger}\NormalTok{(}
\NormalTok{  BMI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ .,}
  \AttributeTok{data =}\NormalTok{ train\_reg,}
  \AttributeTok{num.trees =} \DecValTok{700}\NormalTok{,}
  \AttributeTok{mtry =} \FunctionTok{as.integer}\NormalTok{(best\_params\_rf}\SpecialCharTok{$}\NormalTok{mtry),}
  \AttributeTok{min.node.size =} \FunctionTok{as.integer}\NormalTok{(best\_params\_rf}\SpecialCharTok{$}\NormalTok{min\_node\_size),}
  \AttributeTok{sample.fraction =}\NormalTok{ best\_params\_rf}\SpecialCharTok{$}\NormalTok{sample\_fraction,}
  \AttributeTok{importance =} \StringTok{"impurity"}
\NormalTok{)}

\CommentTok{\# =================}
\CommentTok{\#  Predictions}
\CommentTok{\# =================}

\NormalTok{pred\_rf\_train }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(rf\_model\_final, }\AttributeTok{data =}\NormalTok{ train\_reg)}\SpecialCharTok{$}\NormalTok{predictions}
\NormalTok{pred\_rf\_valid }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(rf\_model\_final, }\AttributeTok{data =}\NormalTok{ valid\_reg)}\SpecialCharTok{$}\NormalTok{predictions}
\NormalTok{pred\_rf\_test  }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(rf\_model\_final, }\AttributeTok{data =}\NormalTok{ test\_reg)}\SpecialCharTok{$}\NormalTok{predictions}

\CommentTok{\# =================================}
\CommentTok{\#  Final Evaluation (Test Set) }
\CommentTok{\# =================================}

\NormalTok{rf\_rmse }\OtherTok{\textless{}{-}} \FunctionTok{rmse}\NormalTok{(test\_reg}\SpecialCharTok{$}\NormalTok{BMI, pred\_rf\_test)}
\NormalTok{rf\_mae  }\OtherTok{\textless{}{-}} \FunctionTok{mae}\NormalTok{(test\_reg}\SpecialCharTok{$}\NormalTok{BMI, pred\_rf\_test)}
\NormalTok{rf\_mape }\OtherTok{\textless{}{-}} \FunctionTok{mape}\NormalTok{(test\_reg}\SpecialCharTok{$}\NormalTok{BMI, pred\_rf\_test)}

\CommentTok{\# caret R2 (predictions first!)}
\NormalTok{rf\_r2 }\OtherTok{\textless{}{-}}\NormalTok{ caret}\SpecialCharTok{::}\FunctionTok{R2}\NormalTok{(pred\_rf\_test, test\_reg}\SpecialCharTok{$}\NormalTok{BMI)}

\CommentTok{\# Adjusted RÂ²}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(test\_reg) }\SpecialCharTok{{-}} \DecValTok{1}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(test\_reg)}
\NormalTok{rf\_adj\_r2 }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ (}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ rf\_r2) }\SpecialCharTok{*}\NormalTok{ ((n }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ p }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{))}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{========= RANDOM FOREST (Ranger) FINAL PERFORMANCE =========}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## ========= RANDOM FOREST (Ranger) FINAL PERFORMANCE =========
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}
  \StringTok{"Test RMSE: \%.4f | MAE: \%.4f | MAPE: \%.2f\%\% | RÂ²: \%.4f | Adj RÂ²: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
\NormalTok{  rf\_rmse, rf\_mae, rf\_mape, rf\_r2, rf\_adj\_r2}
\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Test RMSE: 6.3207 | MAE: 4.4754 | MAPE: 0.16% | RÂ²: 0.1301 | Adj RÂ²: 0.1298
\end{verbatim}

\paragraph{11B.2 XGBoost Regression with Random
Search}\label{b.2-xgboost-regression-with-random-search}

\subparagraph{11B.2.1 Convert Regression Data into Model
Matrices}\label{b.2.1-convert-regression-data-into-model-matrices}

Predictors are one-hot encoded using model.matrix() to ensure XGBoost
receives numeric inputs.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{X\_train }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(BMI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ train\_reg)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{y\_train }\OtherTok{\textless{}{-}}\NormalTok{ train\_reg}\SpecialCharTok{$}\NormalTok{BMI}

\NormalTok{X\_valid }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(BMI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ valid\_reg)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{y\_valid }\OtherTok{\textless{}{-}}\NormalTok{ valid\_reg}\SpecialCharTok{$}\NormalTok{BMI}

\NormalTok{X\_test  }\OtherTok{\textless{}{-}} \FunctionTok{model.matrix}\NormalTok{(BMI }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ test\_reg)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{y\_test  }\OtherTok{\textless{}{-}}\NormalTok{ test\_reg}\SpecialCharTok{$}\NormalTok{BMI}

\NormalTok{dtrain }\OtherTok{\textless{}{-}} \FunctionTok{xgb.DMatrix}\NormalTok{(X\_train, }\AttributeTok{label =}\NormalTok{ y\_train)}
\NormalTok{dvalid }\OtherTok{\textless{}{-}} \FunctionTok{xgb.DMatrix}\NormalTok{(X\_valid, }\AttributeTok{label =}\NormalTok{ y\_valid)}
\NormalTok{dtest  }\OtherTok{\textless{}{-}} \FunctionTok{xgb.DMatrix}\NormalTok{(X\_test,  }\AttributeTok{label =}\NormalTok{ y\_test)}
\end{Highlighting}
\end{Shaded}

\subparagraph{11B.2.2 Random Search using Cross-Validation (CV
RMSE)}\label{b.2.2-random-search-using-cross-validation-cv-rmse}

A random search is conducted over multiple hyperparameter combinations.
Three-fold cross-validation is used to select the configuration with the
lowest CV RMSE.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{123}\NormalTok{)}

\CommentTok{\# Define random search space}
\NormalTok{random\_search\_size }\OtherTok{\textless{}{-}} \DecValTok{30}

\NormalTok{param\_space }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}
  \AttributeTok{eta =} \FunctionTok{runif}\NormalTok{(random\_search\_size, }\FloatTok{0.01}\NormalTok{, }\FloatTok{0.2}\NormalTok{),}
  \AttributeTok{max\_depth =} \FunctionTok{sample}\NormalTok{(}\DecValTok{3}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, random\_search\_size, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{min\_child\_weight =} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{15}\NormalTok{, random\_search\_size, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{subsample =} \FunctionTok{runif}\NormalTok{(random\_search\_size, }\FloatTok{0.6}\NormalTok{, }\FloatTok{1.0}\NormalTok{),}
  \AttributeTok{colsample\_bytree =} \FunctionTok{runif}\NormalTok{(random\_search\_size, }\FloatTok{0.6}\NormalTok{, }\FloatTok{1.0}\NormalTok{),}
  \AttributeTok{gamma =} \FunctionTok{runif}\NormalTok{(random\_search\_size, }\DecValTok{0}\NormalTok{, }\FloatTok{0.3}\NormalTok{)}
\NormalTok{)}

\NormalTok{results }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{()}

\NormalTok{pb }\OtherTok{\textless{}{-}} \FunctionTok{txtProgressBar}\NormalTok{(}\AttributeTok{min =} \DecValTok{0}\NormalTok{, }\AttributeTok{max =}\NormalTok{ random\_search\_size, }\AttributeTok{style =} \DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   |                                                                                                             |                                                                                                     |   0%
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{random\_search\_size) \{}
  
\NormalTok{  params }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
    \AttributeTok{objective =} \StringTok{"reg:squarederror"}\NormalTok{,}
    \AttributeTok{eta =}\NormalTok{ param\_space}\SpecialCharTok{$}\NormalTok{eta[i],}
    \AttributeTok{max\_depth =}\NormalTok{ param\_space}\SpecialCharTok{$}\NormalTok{max\_depth[i],}
    \AttributeTok{min\_child\_weight =}\NormalTok{ param\_space}\SpecialCharTok{$}\NormalTok{min\_child\_weight[i],}
    \AttributeTok{subsample =}\NormalTok{ param\_space}\SpecialCharTok{$}\NormalTok{subsample[i],}
    \AttributeTok{colsample\_bytree =}\NormalTok{ param\_space}\SpecialCharTok{$}\NormalTok{colsample\_bytree[i],}
    \AttributeTok{gamma =}\NormalTok{ param\_space}\SpecialCharTok{$}\NormalTok{gamma[i]}
\NormalTok{  )}
  
  \CommentTok{\# Run CV for current parameter set}
\NormalTok{  cv }\OtherTok{\textless{}{-}} \FunctionTok{xgb.cv}\NormalTok{(}
    \AttributeTok{params =}\NormalTok{ params,}
    \AttributeTok{data =}\NormalTok{ dtrain,}
    \AttributeTok{nrounds =} \DecValTok{400}\NormalTok{,}
    \AttributeTok{nfold =} \DecValTok{3}\NormalTok{,}
    \AttributeTok{early\_stopping\_rounds =} \DecValTok{20}\NormalTok{,}
    \AttributeTok{verbose =} \ConstantTok{FALSE}
\NormalTok{  )}
  
\NormalTok{  best\_iter }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}
    \FunctionTok{is.null}\NormalTok{(cv}\SpecialCharTok{$}\NormalTok{best\_iteration),}
    \FunctionTok{nrow}\NormalTok{(cv}\SpecialCharTok{$}\NormalTok{evaluation\_log),}
\NormalTok{    cv}\SpecialCharTok{$}\NormalTok{best\_iteration}
\NormalTok{  )}
  
\NormalTok{  best\_rmse }\OtherTok{\textless{}{-}} \FunctionTok{min}\NormalTok{(cv}\SpecialCharTok{$}\NormalTok{evaluation\_log}\SpecialCharTok{$}\NormalTok{test\_rmse\_mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
  
\NormalTok{  results }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(}
\NormalTok{    results,}
    \FunctionTok{data.frame}\NormalTok{(}
      \AttributeTok{eta =}\NormalTok{ params}\SpecialCharTok{$}\NormalTok{eta,}
      \AttributeTok{max\_depth =}\NormalTok{ params}\SpecialCharTok{$}\NormalTok{max\_depth,}
      \AttributeTok{min\_child\_weight =}\NormalTok{ params}\SpecialCharTok{$}\NormalTok{min\_child\_weight,}
      \AttributeTok{subsample =}\NormalTok{ params}\SpecialCharTok{$}\NormalTok{subsample,}
      \AttributeTok{colsample\_bytree =}\NormalTok{ params}\SpecialCharTok{$}\NormalTok{colsample\_bytree,}
      \AttributeTok{gamma =}\NormalTok{ params}\SpecialCharTok{$}\NormalTok{gamma,}
      \AttributeTok{best\_iter =}\NormalTok{ best\_iter,}
      \AttributeTok{cv\_rmse =}\NormalTok{ best\_rmse}
\NormalTok{    )}
\NormalTok{  )}
  
  \FunctionTok{setTxtProgressBar}\NormalTok{(pb, i)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   |                                                                                                             |===                                                                                                  |   3%  |                                                                                                             |=======                                                                                              |   7%  |                                                                                                             |==========                                                                                           |  10%  |                                                                                                             |=============                                                                                        |  13%  |                                                                                                             |=================                                                                                    |  17%  |                                                                                                             |====================                                                                                 |  20%  |                                                                                                             |========================                                                                             |  23%  |                                                                                                             |===========================                                                                          |  27%  |                                                                                                             |==============================                                                                       |  30%  |                                                                                                             |==================================                                                                   |  33%  |                                                                                                             |=====================================                                                                |  37%  |                                                                                                             |========================================                                                             |  40%  |                                                                                                             |============================================                                                         |  43%  |                                                                                                             |===============================================                                                      |  47%  |                                                                                                             |==================================================                                                   |  50%  |                                                                                                             |======================================================                                               |  53%  |                                                                                                             |=========================================================                                            |  57%  |                                                                                                             |=============================================================                                        |  60%  |                                                                                                             |================================================================                                     |  63%  |                                                                                                             |===================================================================                                  |  67%  |                                                                                                             |=======================================================================                              |  70%  |                                                                                                             |==========================================================================                           |  73%  |                                                                                                             |=============================================================================                        |  77%  |                                                                                                             |=================================================================================                    |  80%  |                                                                                                             |====================================================================================                 |  83%  |                                                                                                             |========================================================================================             |  87%  |                                                                                                             |===========================================================================================          |  90%  |                                                                                                             |==============================================================================================       |  93%  |                                                                                                             |==================================================================================================   |  97%  |                                                                                                             |=====================================================================================================| 100%
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{close}\NormalTok{(pb)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Random Search Completed.}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Random Search Completed.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================}
\CommentTok{\# Select Best Parameters}
\CommentTok{\# ==========================}

\NormalTok{best\_idx }\OtherTok{\textless{}{-}} \FunctionTok{which.min}\NormalTok{(results}\SpecialCharTok{$}\NormalTok{cv\_rmse)}
\NormalTok{best }\OtherTok{\textless{}{-}}\NormalTok{ results[best\_idx, ]}
\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{{-}{-}{-} BEST XGBOOST PARAMETERS (RANDOM SEARCH) {-}{-}{-}}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## --- BEST XGBOOST PARAMETERS (RANDOM SEARCH) ---
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print}\NormalTok{(best)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##           eta max_depth min_child_weight subsample colsample_bytree      gamma best_iter  cv_rmse
## 18 0.01799131         4               15 0.6588379        0.7757726 0.07970601       400 6.307594
\end{verbatim}

\subparagraph{11B.2.3 Train Final XGBoost Regression and Evaluate on
Test
Set}\label{b.2.3-train-final-xgboost-regression-and-evaluate-on-test-set}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{best\_params }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{objective =} \StringTok{"reg:squarederror"}\NormalTok{,}
  \AttributeTok{eta =}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{eta,}
  \AttributeTok{max\_depth =}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{max\_depth,}
  \AttributeTok{min\_child\_weight =}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{min\_child\_weight,}
  \AttributeTok{subsample =}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{subsample,}
  \AttributeTok{colsample\_bytree =}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{colsample\_bytree,}
  \AttributeTok{gamma =}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{gamma}
\NormalTok{)}

\NormalTok{best\_nrounds }\OtherTok{\textless{}{-}}\NormalTok{ best}\SpecialCharTok{$}\NormalTok{best\_iter }\SpecialCharTok{+} \DecValTok{30}


\CommentTok{\# ==============================}
\CommentTok{\# Train FINAL XGBOOST MODEL}
\CommentTok{\# ==============================}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{Training Final XGBoost Model...}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Training Final XGBoost Model...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{final\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{xgb.train}\NormalTok{(}
  \AttributeTok{params =}\NormalTok{ best\_params,}
  \AttributeTok{data =}\NormalTok{ dtrain,}
  \AttributeTok{nrounds =}\NormalTok{ best\_nrounds,}
  \AttributeTok{watchlist =} \FunctionTok{list}\NormalTok{(}\AttributeTok{valid =}\NormalTok{ dvalid),}
  \AttributeTok{early\_stopping\_rounds =} \DecValTok{20}\NormalTok{,}
  \AttributeTok{print\_every\_n =} \DecValTok{50}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  valid-rmse:28.475343 
## Will train until valid_rmse hasn't improved in 20 rounds.
## 
## [51] valid-rmse:12.901110 
## [101]    valid-rmse:7.827149 
## [151]    valid-rmse:6.630507 
## [201]    valid-rmse:6.406731 
## [251]    valid-rmse:6.363384 
## [301]    valid-rmse:6.353265 
## [351]    valid-rmse:6.350028 
## [401]    valid-rmse:6.347929 
## [430]    valid-rmse:6.347191
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# ==========================}
\CommentTok{\# Evaluate FINAL Model}
\CommentTok{\# ==========================}

\NormalTok{pred\_xgb }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(final\_xgb, dtest)}

\NormalTok{xgb\_rmse }\OtherTok{\textless{}{-}} \FunctionTok{rmse}\NormalTok{(y\_test, pred\_xgb)}
\NormalTok{xgb\_mae  }\OtherTok{\textless{}{-}} \FunctionTok{mae}\NormalTok{(y\_test, pred\_xgb)}
\NormalTok{xgb\_mape }\OtherTok{\textless{}{-}} \FunctionTok{mape}\NormalTok{(y\_test, pred\_xgb)}
\NormalTok{xgb\_r2   }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}} \FunctionTok{sum}\NormalTok{((y\_test }\SpecialCharTok{{-}}\NormalTok{ pred\_xgb)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{) }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{((y\_test }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(y\_test))}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{)}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(y\_test)}
\NormalTok{p }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(X\_test)}
\NormalTok{xgb\_adj\_r2 }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ ((}\DecValTok{1} \SpecialCharTok{{-}}\NormalTok{ xgb\_r2) }\SpecialCharTok{*}\NormalTok{ (n }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}}\NormalTok{ p }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{))}

\FunctionTok{cat}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}n}\StringTok{=========== XGBOOST REGRESSION PERFORMANCE (TEST SET) ===========}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## =========== XGBOOST REGRESSION PERFORMANCE (TEST SET) ===========
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{cat}\NormalTok{(}\FunctionTok{sprintf}\NormalTok{(}
  \StringTok{"RMSE: \%.4f | MAE: \%.4f | MAPE: \%.2f\%\% | RÂ²: \%.4f | Adj RÂ²: \%.4f}\SpecialCharTok{\textbackslash{}n}\StringTok{"}\NormalTok{,}
\NormalTok{  xgb\_rmse, xgb\_mae, xgb\_mape, xgb\_r2, xgb\_adj\_r2}
\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## RMSE: 6.3032 | MAE: 4.4550 | MAPE: 0.16% | RÂ²: 0.1349 | Adj RÂ²: 0.1343
\end{verbatim}

\paragraph{Regression Summary}\label{regression-summary}

Overall, the regression task compares Random Forest regression and
XGBoost regression for predicting BMI. Performance is evaluated using
both error-based metrics (RMSE, MAE, MAPE) and goodness-of-fit metrics
(RÂ², Adjusted RÂ²). The results provide evidence on how demographic,
lifestyle, and chronic condition indicators relate to BMI variation
within the dataset.

\end{document}
